import{m as W,r as d,u as X,n as Z,l as ee,j as k,q as te,d as h,o as y,e as D,f as r,g as i,s as n,v as O,x as _,y as T,t as M,G as ae,z as B}from"./index-2eb3e8c7.js";const oe={class:"grid"},se={class:"col-12"},le={class:"card"},re=r("div",{class:"my-2"},[r("h5",{class:"m-0"},"Master Movement Type")],-1),ie={class:"flex flex-column md:flex-row md:justify-content-between md:align-items-center"},ne={class:"block mt-2 md:mt-0 p-input-icon-left"},de=r("i",{class:"pi pi-search"},null,-1),ce=r("div",{class:"flex flex-column md:flex-row md:justify-content-between md:align-items-center",style:{"text-align":"center",width:"100%"}},[r("span",{style:{width:"100%"}},"No")],-1),ue=r("div",{class:"flex flex-column md:flex-row md:justify-content-between md:align-items-center",style:{"text-align":"right",width:"70%"}},[r("span",{style:{width:"100%"}},"MvT Code")],-1),me=r("span",{style:{width:"100%"}},"Description",-1),ve=[me],pe=r("div",{class:"flex flex-column md:flex-row md:justify-content-between md:align-items-center",style:{"text-align":"center",width:"100%"}},[r("span",{style:{width:"100%"}},"Action")],-1),fe={class:"field"},he=r("label",{for:"code"},"MvT Code",-1),ye={key:0,class:"p-invalid"},we={class:"field"},ge=r("label",{for:"desc"},"Description",-1),_e={key:0,class:"p-invalid"},be={class:"flex align-items-center justify-content-center"},ke=r("i",{class:"pi pi-exclamation-triangle mr-3",style:{"font-size":"2rem"}},null,-1),Te={key:0},Se={__name:"MovementPage",setup(xe){const A=W(),u=d(null),m=X(),P=d(null),F=d(null),$=d(null),j=d([]),E=d(""),w=d(!1),b=d(!1),a=d({}),c=d(null),x=d({}),f=d(!1),C=d(null),v=d(null),g=async t=>{t.page+=1;try{const e=await fetch(`${k}/api/master/mvt?page=${t.page}&sortField=${t.sortField}&sortOrder=${t.sortOrder}&search=${v.value!=null?v.value:""}&paginate_count=${t.rows}`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`}}),l=await e.json();if(C.value=l.data.total,e.ok)j.value=l.data;else throw new Error(l.error||"Failed to fetch data from API")}catch{m.add({severity:"error",summary:"Error",detail:"Failed to fetch data from API",life:5e3})}},V=t=>{var e,l,o;t.target.value?v.value=t.target.value:v.value="",g({page:0,search:v.value,sortField:(e=c.value)==null?void 0:e.sortField,sortOrder:(l=c.value)==null?void 0:l.sortOrder,rows:(o=c.value)==null?void 0:o.rows})};Z(()=>{const t=A.state.permission;t!==null?(u.value=t,P.value=u.value.some(e=>e.name==="create-master"),F.value=u.value.some(e=>e.name==="edit-master"),$.value=u.value.some(e=>e.name==="delete-master")):A.watch(e=>e.permission,e=>{u.value=e,P.value=u.value.some(l=>l.name==="create-master"),F.value=u.value.some(l=>l.name==="edit-master"),$.value=u.value.some(l=>l.name==="delete-master")}),K()}),ee(async()=>{try{const t=await fetch(`${k}/api/master/mvt`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`}}),e=await t.json();if(t.ok)j.value=e.data,C.value=e.data.total;else throw new Error(e.error||"Failed to fetch data from API")}catch{m.add({severity:"error",summary:"Error",detail:"Failed to fetch data from API",life:5e3})}});const z=()=>{a.value={},f.value=!1,w.value=!0,E.value="Add New Movement Type"},L=()=>{w.value=!1,f.value=!1},U=async()=>{var t,e,l;try{const o=await fetch(`${k}/api/master/mvt/${a.value.id}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({code:a.value.code,desc:a.value.desc})}),p=await o.json();if(o.ok)await g({page:0,search:v.value,sortField:(t=c.value)==null?void 0:t.sortField,sortOrder:(e=c.value)==null?void 0:e.sortOrder,rows:(l=c.value)==null?void 0:l.rows}),m.add({severity:"success",summary:"Successful",detail:"Data Movement Type Updated",life:3e3});else throw new Error(p.error||"Failed to update data Movement Type")}catch(o){m.add({severity:"error",summary:"Failed",detail:o,life:5e3})}},R=async()=>{var t,e,l;try{const o=await fetch(`${k}/api/master/mvt`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({code:a.value.code,desc:a.value.desc})}),p=await o.json();if(o.ok)await g({page:0,search:v.value,sortField:(t=c.value)==null?void 0:t.sortField,sortOrder:(e=c.value)==null?void 0:e.sortOrder,rows:(l=c.value)==null?void 0:l.rows}),m.add({severity:"success",summary:"Successful",detail:"Data Movement Type Created",life:3e3});else throw new Error(p.error||"Failed to create data Movement Type")}catch(o){m.add({severity:"error",summary:"Failed",detail:o,life:5e3})}},q=()=>{f.value=!0,a.value.code&&a.value.code.trim()&&a.value.desc&&a.value.desc.trim()&&(a.value.id?U():R(),w.value=!1,a.value={})},G=t=>{a.value={...t},w.value=!0,E.value="Edit Movement Type"},J=t=>{a.value=t,b.value=!0},H=async()=>{var t,e,l;try{const o=await fetch(`${k}/api/master/mvt/${a.value.id}`,{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`}}),p=await o.json();if(o.ok)await g({page:0,search:v.value,sortField:(t=c.value)==null?void 0:t.sortField,sortOrder:(e=c.value)==null?void 0:e.sortOrder,rows:(l=c.value)==null?void 0:l.rows}),b.value=!1,a.value={},m.add({severity:"success",summary:"Successful",detail:"Movement Type Deleted",life:3e3});else throw o.status===500&&p.error.includes("Integrity constraint violation")?new Error("Tidak dapat hapus data ini, karena masih digunakan pada data lain"):new Error(p.error||"Failed to delete Movement Type")}catch(o){m.add({severity:"error",summary:"Error",detail:o.message,life:5e3})}},K=()=>{x.value={global:{value:null,matchMode:te.CONTAINS}}};return(t,e)=>{const l=h("Toast"),o=h("Button"),p=h("Toolbar"),I=h("InputText"),S=h("Column"),Y=h("DataTable"),N=h("Dialog");return y(),D("div",oe,[r("div",se,[r("div",le,[i(l),i(p,{class:"mb-4 p-0",style:{border:"none","background-color":"white"}},{start:n(()=>[re]),end:n(()=>[P.value?(y(),O(o,{key:0,label:"Add New",icon:"pi pi-plus-circle",class:"p-button-primary mr-2",onClick:z})):_("",!0)]),_:1}),i(Y,{ref_key:"dt",ref:c,value:j.value.data,lazy:"",filters:x.value,first:t.first,onPage:e[2]||(e[2]=s=>g(s)),last:C.value,loading:t.loading,totalRecords:C.value,dataKey:"id",class:"p-datatable-gridlines",paginator:!0,onSort:e[3]||(e[3]=s=>g(s)),rows:10,paginatorTemplate:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",rowsPerPageOptions:[5,10,25],currentPageReportTemplate:"Showing {first} to {last} of {totalRecords} datamaster",responsiveLayout:"scroll"},{header:n(()=>[r("div",ie,[r("span",ne,[de,i(I,{modelValue:x.value.global.value,"onUpdate:modelValue":e[0]||(e[0]=s=>x.value.global.value=s),placeholder:"Search...",onInput:e[1]||(e[1]=s=>V(s))},null,8,["modelValue"])])])]),default:n(()=>[i(S,{field:"rowIndex",headerStyle:"min-width:5%;",style:{"text-align":"center"}},{header:n(()=>[ce]),body:n(s=>[T(M(s.index+1),1)]),_:1}),i(S,{field:"code",headerStyle:"width:25%; min-width:10rem;"},{header:n(()=>[ue]),body:n(s=>[T(M(s.data.code),1)]),_:1}),i(S,{field:"desc",headerStyle:"width:55%; min-width:10rem;"},{header:n(()=>[r("div",{class:"flex flex-column md:flex-row md:justify-content-between md:align-items-center",style:ae({"text-align":"right",width:t.isSmallScreen?"70%":"58%"})},ve,4)]),body:n(s=>[T(M(s.data.desc),1)]),_:1}),i(S,{headerStyle:"min-width:10rem;",style:{"text-align":"center"}},{header:n(()=>[pe]),body:n(s=>[F.value?(y(),O(o,{key:0,icon:"pi pi-file-edit",class:"p-button-text p-button-primary mt-2",onClick:Q=>G(s.data)},null,8,["onClick"])):_("",!0),$.value?(y(),O(o,{key:1,icon:"pi pi-trash",class:"p-button-text p-button-danger mt-2",onClick:Q=>J(s.data)},null,8,["onClick"])):_("",!0)]),_:1})]),_:1},8,["value","filters","first","last","loading","totalRecords"]),i(N,{visible:w.value,"onUpdate:visible":e[6]||(e[6]=s=>w.value=s),style:{width:"450px"},header:E.value,modal:!0,class:"p-fluid"},{footer:n(()=>[i(o,{label:"Cancel",icon:"pi pi-times",onClick:L,style:{background:"white",color:"blue"}}),i(o,{label:"Save",icon:"pi pi-check",class:"p-button-primary",onClick:q})]),default:n(()=>[r("div",fe,[he,i(I,{id:"code",modelValue:a.value.code,"onUpdate:modelValue":e[4]||(e[4]=s=>a.value.code=s),modelModifiers:{trim:!0},required:"true",autofocus:"",class:B({"p-invalid":f.value&&!a.value.code})},null,8,["modelValue","class"]),f.value&&!a.value.code?(y(),D("small",ye,"MvT Code is required.")):_("",!0)]),r("div",we,[ge,i(I,{id:"desc",modelValue:a.value.desc,"onUpdate:modelValue":e[5]||(e[5]=s=>a.value.desc=s),modelModifiers:{trim:!0},required:"true",autofocus:"",class:B({"p-invalid":f.value&&!a.value.desc})},null,8,["modelValue","class"]),f.value&&!a.value.desc?(y(),D("small",_e,"Description is required.")):_("",!0)])]),_:1},8,["visible","header"]),i(N,{visible:b.value,"onUpdate:visible":e[8]||(e[8]=s=>b.value=s),style:{width:"450px"},header:"Confirm",modal:!0},{footer:n(()=>[i(o,{label:"No",icon:"pi pi-times",style:{background:"white",color:"red",borderColor:"red"},onClick:e[7]||(e[7]=s=>b.value=!1)}),i(o,{label:"Yes",icon:"pi pi-check",class:"p-button-primary",onClick:H})]),default:n(()=>[r("div",be,[ke,a.value?(y(),D("span",Te,[T("Are you sure you want to delete "),r("b",null,M(a.value.code),1),T("?")])):_("",!0)])]),_:1},8,["visible"])])])])}}};export{Se as default};
