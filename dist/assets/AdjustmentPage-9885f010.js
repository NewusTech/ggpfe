import{m as G,r as u,u as K,n as H,l as J,j as T,q as Y,d as m,o as p,e as w,f as l,g as o,s as a,v as E,x,y as i,t as c}from"./index-2eb3e8c7.js";const W={class:"grid mt-1"},X={class:"col-12"},Z={class:"card"},ee=l("div",{class:"my-2"},[l("h5",{class:"m-0"},"Adjustment")],-1),te={key:1,class:"my-2"},ae={class:"flex flex-column md:flex-row md:justify-content-between md:align-items-center"},oe={class:"block mt-2 md:mt-0 p-input-icon-left"},se=l("i",{class:"pi pi-search"},null,-1),le=l("div",{class:"flex flex-column md:flex-row md:justify-content-between md:align-items-center",style:{"text-align":"center",width:"100%"}},[l("span",{style:{width:"100%"}},"No")],-1),re=l("div",{class:"flex flex-column md:flex-row md:justify-content-between md:align-items-center",style:{"text-align":"center",width:"90%"}},[l("span",{style:{width:"100%"}},"Adjustment Number")],-1),ne=l("div",{class:"flex flex-column md:flex-row md:justify-content-between md:align-items-center",style:{"text-align":"center",width:"90%"}},[l("span",{style:{width:"100%"}},"Storage Location")],-1),de=l("div",{class:"flex flex-column md:flex-row md:justify-content-between md:align-items-center",style:{"text-align":"center",width:"90%"}},[l("span",{style:{width:"100%"}},"Adjustment Category")],-1),ie=l("div",{class:"flex flex-column md:flex-row md:justify-content-between md:align-items-center",style:{"text-align":"center",width:"90%"}},[l("span",{style:{width:"100%"}},"Storage Bin")],-1),ce=l("div",{class:"flex flex-column md:flex-row md:justify-content-between md:align-items-center",style:{"text-align":"center",width:"90%"}},[l("span",{style:{width:"100%"}},"Description")],-1),ue=l("div",{class:"flex flex-column md:flex-row md:justify-content-between md:align-items-center",style:{"text-align":"center",width:"90%"}},[l("span",{style:{width:"100%"}},"Status")],-1),me={key:0,class:"text-primary"},pe={key:1,style:{color:"red"}},ye=l("div",{class:"flex flex-column md:flex-row md:justify-content-between md:align-items-center",style:{"text-align":"center",width:"100%"}},[l("span",{style:{width:"100%"}},"Action")],-1),he=l("div",{class:"field"},[l("label",{for:"material_code"},"Choose your data to aprove")],-1),fe={class:"flex align-items-center justify-content-center"},ve=l("i",{class:"pi pi-exclamation-triangle mr-3",style:{"font-size":"2rem"}},null,-1),_e={key:0},xe={__name:"AdjustmentPage",setup(ge){const F=G(),y=u(null),h=K(),j=u(!1),I=u(""),B=u(null),D=u(null),k=u([]),$=u([]),_=u(!1),g=u({}),f=u(null),S=u({}),v=u(null),A=u(null),C=u(),b=async s=>{s.page+=1;try{const t=`${T}/api/adjustment?page=${s.page}&sortField=${s.sortField}&sortOrder=${s.sortOrder}&search=${v.value!=null?v.value:""}`,d=await fetch(t,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`}}),r=await d.json();if(A.value=r.data.total,d.ok)k.value=r.data.data;else throw new Error(r.error||"Failed to fetch data from API")}catch(t){console.error("Error fetching data from API:",t),h.add({severity:"error",summary:"Error",detail:"Failed to fetch data from API",life:5e3})}},O=s=>{s.target.value?v.value=s.target.value:v.value="",b({page:0,search:s.target.value})};H(()=>{const s=F.state.permission;s!==null?(y.value=s,B.value=y.value.some(t=>t.name==="add-adjustment"),D.value=y.value.some(t=>t.name==="approval-adjustment")):F.watch(t=>t.permission,t=>{y.value=t,B.value=y.value.some(d=>d.name==="add-adjustment"),D.value=y.value.some(d=>d.name==="approval-adjustment")}),R()}),J(async()=>{try{const s=`${T}/api/adjustment`,t=await fetch(s,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`}}),d=await t.json();if(t.ok)k.value=d.data.data,A.value=d.data.total;else throw new Error(d.error||"Failed to fetch data from API")}catch(s){console.error("Error fetching data from API:",s),h.add({severity:"error",summary:"Error",detail:"Failed to fetch data from API",life:5e3})}});const q=s=>{g.value=s,_.value=!0},M=async()=>{var s,t,d;try{const r=await fetch(`${T}/api/adjustment/${g.value.id}`,{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`}}),P=await r.json();if(r.ok)b({page:0,search:v.value,sortField:(s=f.value)==null?void 0:s.sortField,sortOrder:(t=f.value)==null?void 0:t.sortOrder,rows:(d=f.value)==null?void 0:d.rows}),_.value=!1,g.value={},h.add({severity:"success",summary:"Successful",detail:"Storage Bin Deleted",life:3e3});else throw r.status===500&&P.error.includes("Integrity constraint violation")?new Error("Tidak dapat hapus data ini, karena masih digunakan pada data lain"):new Error(P.error||"Failed to delete Storage Bin")}catch(r){console.error("Error deleting Storage Bin:",r),h.add({severity:"error",summary:"Error",detail:r.message,life:5e3})}},R=()=>{S.value={global:{value:null,matchMode:Y.CONTAINS}}},U=async()=>{var t,d;const s=C.value.map(r=>r.id);console.log(s);try{if((await fetch(`${T}/api/adjustment/approve`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({id_adjustment:s})})).ok)j.value=!1,C.value=[],b({page:0,search:v.value,sortField:(t=f.value)==null?void 0:t.sortField,sortOrder:(d=f.value)==null?void 0:d.sortOrder}),h.add({severity:"success",summary:"Successful",detail:"Aproved",life:3e3});else throw new Error(data.error||"Failed")}catch(r){h.add({severity:"error",summary:"Failed",detail:r,life:5e3})}},V=async()=>{$.value=k.value.filter(s=>s.status===0),j.value=!0,I.value="Aproval"};return(s,t)=>{const d=m("Toast"),r=m("Button"),P=m("router-link"),z=m("Toolbar"),Q=m("InputText"),n=m("Column"),N=m("DataTable"),L=m("Dialog");return p(),w("div",W,[l("div",X,[l("div",Z,[o(d),o(z,{class:"mb-4 p-0",style:{border:"none","background-color":"white"}},{start:a(()=>[ee]),end:a(()=>[B.value?(p(),E(P,{key:0,to:"adjustment/form-adjustment"},{default:a(()=>[o(r,{label:"Add New",icon:"pi pi-plus-circle",class:"p-button-primary mr-2"})]),_:1})):x("",!0),D.value?(p(),w("div",te,[o(r,{label:"Aproval",class:"p-button-primary",onClick:V})])):x("",!0)]),_:1}),o(N,{ref_key:"dt",ref:f,value:k.value,lazy:"",filters:S.value,first:s.first,onPage:t[2]||(t[2]=e=>b(e)),last:A.value,loading:s.loading,totalRecords:A.value,dataKey:"id",class:"p-datatable-gridlines",paginator:!0,onSort:t[3]||(t[3]=e=>b(e)),rows:10,paginatorTemplate:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",rowsPerPageOptions:[5,10,25],currentPageReportTemplate:"Showing {first} to {last} of {totalRecords} datamaster",responsiveLayout:"scroll"},{header:a(()=>[l("div",ae,[l("span",oe,[se,o(Q,{modelValue:S.value.global.value,"onUpdate:modelValue":t[0]||(t[0]=e=>S.value.global.value=e),placeholder:"Search...",onInput:t[1]||(t[1]=e=>O(e))},null,8,["modelValue"])])])]),default:a(()=>[o(n,{field:"rowIndex",headerStyle:"min-width:5%;",style:{"text-align":"center"}},{header:a(()=>[le]),body:a(e=>[i(c(e.index+1),1)]),_:1}),o(n,{field:"adjustment_number",headerStyle:"width:15%;"},{header:a(()=>[re]),body:a(e=>[i(c(e.data.adjustment_number),1)]),_:1}),o(n,{field:"s_loc",headerStyle:"width:15%;"},{header:a(()=>[ne]),body:a(e=>[i(c(e.data.materialloc.sbin.sloc.name),1)]),_:1}),o(n,{field:"adjustment",headerStyle:"width:15%;"},{header:a(()=>[de]),body:a(e=>[i(c(e.data.adjustment.name),1)]),_:1}),o(n,{field:"s_bin",headerStyle:"width:10%;"},{header:a(()=>[ie]),body:a(e=>[i(c(e.data.materialloc.sbin.name),1)]),_:1}),o(n,{field:"description",headerStyle:"width:15%;"},{header:a(()=>[ce]),body:a(e=>[i(c(e.data.description),1)]),_:1}),o(n,{field:"status",headerStyle:"width:10%;"},{header:a(()=>[ue]),body:a(e=>[e.data.status===1?(p(),w("p",me,"Approved")):(p(),w("p",pe,"On Request"))]),_:1}),o(n,{style:{"text-align":"center"},headerStyle:"width:15%;"},{header:a(()=>[ye]),body:a(e=>[e.data.status===0?(p(),E(r,{key:0,icon:"pi pi-file-edit",class:"p-button-text p-button-primary mt-2"})):x("",!0),e.data.status===0?(p(),E(r,{key:1,icon:"pi pi-trash",class:"p-button-text p-button-danger mt-2",onClick:be=>q(e.data)},null,8,["onClick"])):x("",!0)]),_:1})]),_:1},8,["value","filters","first","last","loading","totalRecords"]),o(L,{visible:j.value,"onUpdate:visible":t[5]||(t[5]=e=>j.value=e),style:{width:"95%"},header:I.value,modal:!0,class:"p-fluid"},{footer:a(()=>[o(r,{label:"Cancel",onClick:s.hideDialog,style:{background:"white",color:"blue"}},null,8,["onClick"]),o(r,{label:"Aprove",onClick:U,class:"p-button-primary"})]),default:a(()=>[he,o(N,{selection:C.value,"onUpdate:selection":t[4]||(t[4]=e=>C.value=e),value:$.value,dataKey:"id",responsiveLayout:"scroll"},{default:a(()=>[o(n,{selectionMode:"multiple",headerStyle:"width: 3rem"}),o(n,{field:"adjustment_number",header:"Adjustment Number"},{body:a(e=>[i(c(e.data.adjustment_number),1)]),_:1}),o(n,{field:"sloc",header:"Storage Location"},{body:a(e=>[i(c(e.data.materialloc.sbin.sloc.name),1)]),_:1}),o(n,{field:"sbin",header:"Storage Bin"},{body:a(e=>[i(c(e.data.materialloc.sbin.name),1)]),_:1}),o(n,{field:"adjustment",header:"Ctgr. Adjustment"},{body:a(e=>[i(c(e.data.adjustment.name),1)]),_:1}),o(n,{field:"material_code",header:"Material Code"},{body:a(e=>[i(c(e.data.materialloc.material.code),1)]),_:1}),o(n,{field:"material_desc",header:"Material Desc"},{body:a(e=>[i(c(e.data.materialloc.material.desc),1)]),_:1}),o(n,{field:"qty",header:"Qty"},{body:a(e=>[i(c(e.data.qty_before),1)]),_:1}),o(n,{field:"qty_physical",header:"Qty physical"},{body:a(e=>[i(c(e.data.qty_physical),1)]),_:1}),o(n,{field:"qty_adjustment",header:"Qty adjustment"},{body:a(e=>[i(c(e.data.qty_adjustment),1)]),_:1}),o(n,{field:"batch",header:"Batch"},{body:a(e=>[i(c(e.data.batch),1)]),_:1})]),_:1},8,["selection","value"])]),_:1},8,["visible","header"]),o(L,{visible:_.value,"onUpdate:visible":t[7]||(t[7]=e=>_.value=e),style:{width:"450px"},header:"Confirm",modal:!0},{footer:a(()=>[o(r,{label:"No",icon:"pi pi-times",style:{background:"white",color:"red",borderColor:"red"},onClick:t[6]||(t[6]=e=>_.value=!1)}),o(r,{label:"Yes",icon:"pi pi-check",class:"p-button-primary",onClick:M})]),default:a(()=>[l("div",fe,[ve,g.value?(p(),w("span",_e,[i("Are you sure you want to delete "),l("b",null,c(g.value.s_bin),1),i("?")])):x("",!0)])]),_:1},8,["visible"])])])])}}};export{xe as default};
