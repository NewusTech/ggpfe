import{m as te,r as d,u as le,n as oe,l as se,j as f,q as ie,d as k,o as u,e as c,f as l,g as n,s as r,v as z,x as w,y as x,t as m,z as T}from"./index-2eb3e8c7.js";const re={class:"grid mt-1"},ne={class:"col-12"},de={class:"card"},ue=l("div",{class:"my-2"},[l("h5",{class:"m-0"},"Master Material")],-1),ce={class:"flex flex-column md:flex-row md:justify-content-between md:align-items-center"},me={class:"block mt-2 md:mt-0 p-input-icon-left"},ve=l("i",{class:"pi pi-search"},null,-1),pe=l("div",{class:"flex flex-column md:flex-row md:justify-content-between md:align-items-center",style:{"text-align":"center",width:"100%"}},[l("span",{style:{width:"100%"}},"No")],-1),he=l("div",{class:"flex flex-column md:flex-row md:justify-content-between md:align-items-center",style:{"text-align":"center",width:"90%"}},[l("span",{style:{width:"100%"}},"Material Code")],-1),fe=l("div",{class:"flex flex-column md:flex-row md:justify-content-between md:align-items-center",style:{"text-align":"center",width:"90%"}},[l("span",{style:{width:"100%"}},"Material Description")],-1),_e=l("div",{class:"flex flex-column md:flex-row md:justify-content-between md:align-items-center",style:{"text-align":"center",width:"90%"}},[l("span",{style:{width:"100%"}},"UOM")],-1),ye=l("div",{class:"flex flex-column md:flex-row md:justify-content-between md:align-items-center",style:{"text-align":"center",width:"90%"}},[l("span",{style:{width:"100%"}},"Batch")],-1),we=l("div",{class:"flex flex-column md:flex-row md:justify-content-between md:align-items-center",style:{"text-align":"center",width:"90%"}},[l("span",{style:{width:"100%"}},"Plant")],-1),ge=l("div",{class:"flex flex-column md:flex-row md:justify-content-between md:align-items-center",style:{"text-align":"center",width:"100%"}},[l("span",{style:{width:"100%"}},"Action")],-1),be={class:"field"},ke=l("label",{for:"code"},"Material Code",-1),xe={key:0,class:"p-invalid"},Te={class:"field"},Ce=l("label",{for:"desc"},"Material Description",-1),Se={key:0,class:"p-invalid"},je={class:"flex justify-center-between",style:{width:"100%"}},$e={class:"field",style:{width:"49%"}},Me=l("label",{for:"uom_id",class:"mb-3"},"UoM",-1),Fe={key:0},Ee={key:1},De={key:0,class:"p-invalid"},Ie={class:"field",style:{width:"49%","margin-left":"auto"}},Ae=l("label",{for:"batch",class:"mb-3"},"Use Batch ?",-1),Ve={key:0},Be={key:1},Pe={key:2},Ue={key:0,class:"p-invalid"},Oe={class:"flex justify-center-between",style:{width:"100%"}},ze={class:"field",style:{width:"49%"}},Ne=l("label",{for:"plant_id",class:"mb-3"},"Plant",-1),Le={key:0},qe={key:1},Ge={key:0,class:"p-invalid"},Re={class:"flex align-items-center justify-content-center"},Ye=l("i",{class:"pi pi-exclamation-triangle mr-3",style:{"font-size":"2rem"}},null,-1),Je={key:0},Qe={__name:"MaterialPage",setup(He){const N=te(),g=d(null),_=le(),I=d(null),A=d(null),V=d(null),B=d([]),P=d(""),C=d(!1),j=d(!1),t=d({}),v=d(null),F=d({}),p=d(!1),E=d(null),b=d(null),D=d([]),U=d([]),L=d([{label:"Ya",value:1},{label:"Tidak",value:0}]),S=async s=>{s.page+=1;try{const e=`${f}/api/master/material?page=${s.page}&sortField=${s.sortField}&sortOrder=${s.sortOrder}&search=${b.value!=null?b.value:""}&paginate_count=${s.rows}`,i=await fetch(e,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`}}),o=await i.json();if(E.value=o.data.total,i.ok)B.value=o.data;else throw new Error(o.error||"Failed to fetch data from API")}catch{_.add({severity:"error",summary:"Error",detail:"Failed to fetch data from API",life:5e3})}},G=s=>{var e,i,o;s.target.value?b.value=s.target.value:b.value="",S({page:0,search:b.value,sortField:(e=v.value)==null?void 0:e.sortField,sortOrder:(i=v.value)==null?void 0:i.sortOrder,rows:(o=v.value)==null?void 0:o.rows})};oe(()=>{const s=N.state.permission;s!==null?(g.value=s,I.value=g.value.some(e=>e.name==="create-master"),A.value=g.value.some(e=>e.name==="edit-master"),V.value=g.value.some(e=>e.name==="delete-master")):N.watch(e=>e.permission,e=>{g.value=e,I.value=g.value.some(i=>i.name==="create-master"),A.value=g.value.some(i=>i.name==="edit-master"),V.value=g.value.some(i=>i.name==="delete-master")}),ee()}),se(async()=>{try{const s=`${f}/api/master/material`,e=await fetch(s,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`}}),i=await e.json();if(e.ok)B.value=i.data,E.value=i.data.total;else throw new Error(i.error||"Failed to fetch data from API");const o=await fetch(`${f}/api/master/plant`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`}}),h=await o.json();if(o.ok)U.value=h.data.data;else throw new Error(h.error||"Failed to fetch plant data from API")}catch{_.add({severity:"error",summary:"Error",detail:"Failed to fetch data from API",life:5e3})}});const R=async()=>{t.value={};const s=await fetch(`${f}/api/master/uom`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`}}),e=await s.json();if(s.ok)D.value=e.data.data;else throw new Error(e.error||"Failed to fetch uom data from API");p.value=!1,C.value=!0,P.value="Add New Material"},Y=()=>{C.value=!1,p.value=!1},J=async()=>{var s,e,i;try{const o=await fetch(`${f}/api/master/material/${t.value.id}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({code:t.value.code,desc:t.value.desc,uom_id:t.value.uom_id.id,is_batch:t.value.batch.value,plant_id:t.value.plant_id.id})}),h=await o.json();if(o.ok)await S({page:0,search:b.value,sortField:(s=v.value)==null?void 0:s.sortField,sortOrder:(e=v.value)==null?void 0:e.sortOrder,rows:(i=v.value)==null?void 0:i.rows}),_.add({severity:"success",summary:"Successful",detail:"Data Material Updated",life:3e3});else throw new Error(h.error||"Failed to update data Material")}catch(o){_.add({severity:"error",summary:"Failed",detail:o,life:5e3})}},H=async()=>{var s,e,i;try{const o=await fetch(`${f}/api/master/material`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({code:t.value.code,desc:t.value.desc,uom_id:t.value.uom_id.id,is_batch:t.value.batch.value,plant_id:t.value.plant_id.id})}),h=await o.json();if(o.ok)await S({page:0,search:b.value,sortField:(s=v.value)==null?void 0:s.sortField,sortOrder:(e=v.value)==null?void 0:e.sortOrder,rows:(i=v.value)==null?void 0:i.rows}),_.add({severity:"success",summary:"Successful",detail:"Data Material Created",life:3e3});else throw new Error(h.error||"Failed to create data Material")}catch(o){_.add({severity:"error",summary:"Failed",detail:o,life:5e3})}},K=()=>{p.value=!0,t.value.code&&t.value.code.trim()&&t.value.desc&&t.value.desc.trim()&&t.value.plant_id.id!==null&&t.value.batch&&t.value.batch.value!==null&&t.value.uom_id&&t.value.uom_id.id!==null&&(t.value.id?J():H(),C.value=!1,t.value={})},Q=async s=>{try{const e=await fetch(`${f}/api/master/uom?search=${s.value}&paginate_count=15`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`}}),i=await e.json();if(e.ok)D.value=i.data.data;else throw new Error(i.error||"Failed to fetch storage location data from API")}catch{_.add({severity:"error",summary:"Error",detail:"Failed to fetch storage locations",life:5e3})}},W=async s=>{t.value={...s};const e=await fetch(`${f}/api/master/uom`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`}}),i=await e.json();if(e.ok)D.value=i.data.data;else throw new Error(i.error||"Failed to fetch uom data from API");const o=await fetch(`${f}/api/master/uom?search=${t.value.uom.name}`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`}}),h=await o.json();o.ok&&(t.value.uom_id=h.data.data[0],console.log(t.value.uom_id));const $=U.value.find(M=>M.id===t.value.plant_id);t.value.plant_id=$;const y=L.value.find(M=>M.value===t.value.is_batch);t.value.batch=y,C.value=!0,P.value="Edit Material"},X=s=>{t.value=s,j.value=!0},Z=async()=>{var s,e,i;try{const o=await fetch(`${f}/api/master/material/${t.value.id}`,{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`}}),h=await o.json();if(o.ok)await S({page:0,search:b.value,sortField:(s=v.value)==null?void 0:s.sortField,sortOrder:(e=v.value)==null?void 0:e.sortOrder,rows:(i=v.value)==null?void 0:i.rows}),j.value=!1,t.value={},_.add({severity:"success",summary:"Successful",detail:"Material Deleted",life:3e3});else throw o.status===500&&h.error.includes("Integrity constraint violation")?new Error("Tidak dapat hapus data ini, karena masih digunakan pada data lain"):new Error(h.error||"Failed to delete Material")}catch(o){_.add({severity:"error",summary:"Error",detail:o.message,life:5e3})}},ee=()=>{F.value={global:{value:null,matchMode:ie.CONTAINS}}};return(s,e)=>{const i=k("Toast"),o=k("Button"),h=k("Toolbar"),$=k("InputText"),y=k("Column"),M=k("DataTable"),O=k("Dropdown"),q=k("Dialog");return u(),c("div",re,[l("div",ne,[l("div",de,[n(i),n(h,{class:"mb-4 p-0",style:{border:"none","background-color":"white"}},{start:r(()=>[ue]),end:r(()=>[I.value?(u(),z(o,{key:0,label:"Add New",icon:"pi pi-plus-circle",class:"p-button-primary mr-2",onClick:R})):w("",!0)]),_:1}),n(M,{ref_key:"dt",ref:v,value:B.value.data,lazy:"",filters:F.value,first:s.first,onPage:e[2]||(e[2]=a=>S(a)),last:E.value,loading:s.loading,totalRecords:E.value,dataKey:"id",class:"p-datatable-gridlines",paginator:!0,onSort:e[3]||(e[3]=a=>S(a)),rows:10,paginatorTemplate:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",rowsPerPageOptions:[5,10,25],currentPageReportTemplate:"Showing {first} to {last} of {totalRecords} datamaster",responsiveLayout:"scroll"},{header:r(()=>[l("div",ce,[l("span",me,[ve,n($,{modelValue:F.value.global.value,"onUpdate:modelValue":e[0]||(e[0]=a=>F.value.global.value=a),placeholder:"Search...",onInput:e[1]||(e[1]=a=>G(a))},null,8,["modelValue"])])])]),default:r(()=>[n(y,{field:"rowIndex",headerStyle:"min-width:5%;",style:{"text-align":"center"}},{header:r(()=>[pe]),body:r(a=>[x(m(a.index+1),1)]),_:1}),n(y,{field:"code",headerStyle:"width:25%; min-width:10rem;"},{header:r(()=>[he]),body:r(a=>[x(m(a.data.code),1)]),_:1}),n(y,{field:"desc",headerStyle:"width:30%; min-width:10rem;"},{header:r(()=>[fe]),body:r(a=>[x(m(a.data.desc),1)]),_:1}),n(y,{field:"uom",headerStyle:"width:10%; min-width:10rem;"},{header:r(()=>[_e]),body:r(a=>[x(m(a.data.uom.name),1)]),_:1}),n(y,{field:"batch",headerStyle:"width:10%; min-width:10rem;"},{header:r(()=>[ye]),body:r(a=>[x(m(a.data.batch===1?"Ya":"Tidak"),1)]),_:1}),n(y,{field:"plant",headerStyle:"width:10%; min-width:10rem;"},{header:r(()=>[we]),body:r(a=>[x(m(a.data.plant.name),1)]),_:1}),n(y,{headerStyle:"min-width:10rem;",style:{"text-align":"center"}},{header:r(()=>[ge]),body:r(a=>[A.value?(u(),z(o,{key:0,icon:"pi pi-file-edit",class:"p-button-text p-button-primary mt-2",onClick:ae=>W(a.data)},null,8,["onClick"])):w("",!0),V.value?(u(),z(o,{key:1,icon:"pi pi-trash",class:"p-button-text p-button-danger mt-2",onClick:ae=>X(a.data)},null,8,["onClick"])):w("",!0)]),_:1})]),_:1},8,["value","filters","first","last","loading","totalRecords"]),n(q,{visible:C.value,"onUpdate:visible":e[9]||(e[9]=a=>C.value=a),style:{width:"750px"},header:P.value,modal:!0,class:"p-fluid"},{footer:r(()=>[n(o,{label:"Cancel",icon:"pi pi-times",onClick:Y,style:{background:"white",color:"blue"}}),n(o,{label:"Save",icon:"pi pi-check",class:"p-button-primary",onClick:K})]),default:r(()=>[l("div",be,[ke,n($,{id:"code",modelValue:t.value.code,"onUpdate:modelValue":e[4]||(e[4]=a=>t.value.code=a),modelModifiers:{trim:!0},required:"true",autofocus:"",class:T({"p-invalid":p.value&&!t.value.code})},null,8,["modelValue","class"]),p.value&&!t.value.code?(u(),c("small",xe,"Material code is required.")):w("",!0)]),l("div",Te,[Ce,n($,{id:"desc",modelValue:t.value.desc,"onUpdate:modelValue":e[5]||(e[5]=a=>t.value.desc=a),modelModifiers:{trim:!0},required:"true",autofocus:"",class:T({"p-invalid":p.value&&!t.value.desc})},null,8,["modelValue","class"]),p.value&&!t.value.desc?(u(),c("small",Se,"Material description is required.")):w("",!0)]),l("div",je,[l("div",$e,[Me,n(O,{id:"uom_id",modelValue:t.value.uom_id,"onUpdate:modelValue":e[6]||(e[6]=a=>t.value.uom_id=a),options:D.value,optionLabel:"name",placeholder:"Select a uom",class:T({"p-invalid":p.value&&!t.value.uom_id}),required:"true",onFilter:Q,filter:""},{value:r(a=>[a.value&&a.value.id?(u(),c("div",Fe,m(a.value.name),1)):(u(),c("span",Ee,m(a.placeholder),1))]),_:1},8,["modelValue","options","class"]),p.value&&!t.value.uom_id?(u(),c("small",De,"UoM is required.")):w("",!0)]),l("div",Ie,[Ae,n(O,{id:"batch",modelValue:t.value.batch,"onUpdate:modelValue":e[7]||(e[7]=a=>t.value.batch=a),options:L.value,optionLabel:"label",placeholder:"Select a batch",class:T({"p-invalid":p.value&&!t.value.batch}),required:"true"},{value:r(a=>[a.value&&a.value.value?(u(),c("div",Ve,[l("span",{class:T("product-badge status-"+a.value.value)},m(a.value.label),3)])):a.value&&!a.value.value?(u(),c("div",Be,[l("span",{class:T("product-badge status-"+a.value.label.toLowerCase())},m(a.value.label),3)])):(u(),c("span",Pe,m(a.placeholder),1))]),_:1},8,["modelValue","options","class"]),p.value&&!t.value.batch?(u(),c("small",Ue,"Select batch status is required.")):w("",!0)])]),l("div",Oe,[l("div",ze,[Ne,n(O,{id:"plant",modelValue:t.value.plant_id,"onUpdate:modelValue":e[8]||(e[8]=a=>t.value.plant_id=a),options:U.value,optionLabel:"name",placeholder:"Select a plant",class:T({"p-invalid":p.value&&!t.value.plant_id}),required:"true"},{value:r(a=>[a.value&&a.value.id?(u(),c("div",Le,m(a.value.name),1)):(u(),c("span",qe,m(a.placeholder),1))]),_:1},8,["modelValue","options","class"]),p.value&&!t.value.plant_id?(u(),c("small",Ge,"Plant is required.")):w("",!0)])])]),_:1},8,["visible","header"]),n(q,{visible:j.value,"onUpdate:visible":e[11]||(e[11]=a=>j.value=a),style:{width:"450px"},header:"Confirm",modal:!0},{footer:r(()=>[n(o,{label:"No",icon:"pi pi-times",style:{background:"white",color:"red",borderColor:"red"},onClick:e[10]||(e[10]=a=>j.value=!1)}),n(o,{label:"Yes",icon:"pi pi-check",class:"p-button-primary",onClick:Z})]),default:r(()=>[l("div",Re,[Ye,t.value?(u(),c("span",Je,[x("Are you sure you want to delete "),l("b",null,m(t.value.material_code),1),x("?")])):w("",!0)])]),_:1},8,["visible"])])])])}}};export{Qe as default};
