import{m as Y,a as Z,u as ee,r as d,n as ae,l as te,j as c,w as U,d as v,o as n,e as i,g as r,s as p,f as o,z as b,x as S,F as oe,v as le,t as m,A as G}from"./index-2eb3e8c7.js";const se=["href","onClick"],ne={class:"text-primary font-semibold"},re=["href","target"],ie={class:"text-color"},de={class:"grid"},ce={class:"col-12"},ue={class:"card"},me=o("div",{class:"my-1"},[o("h5",{class:"m-0"},"Add New Adjustment")],-1),ve={class:"formgrid grid p-fluid"},_e={class:"field col-12 md:col-6 mb-4"},pe=o("label",{for:"adjustment_id"},"Category Adjustment",-1),he={key:0},fe={key:1},ye={key:0,class:"p-invalid text-red-500"},ge={class:"field col-12 md:col-6 mb-4"},be=o("label",{for:"s_loc"},"Storage Location",-1),je={key:0},we={key:1},ke={class:"field col-12 md:col-6 mb-4"},Ae=o("label",{for:"material_id"},"Material",-1),qe={key:0},$e={key:1},Ve={key:0,class:"p-invalid text-red-500"},Ie={class:"field col-12 md:col-6 mb-4"},Ee=o("label",{for:"s_bin"},"Storage Bin",-1),Te={key:0},Se={key:1},Be={key:0,class:"p-invalid text-red-500"},Ce={class:"field col-6 md:col-3"},Fe=o("label",{for:"zip"},"Qty",-1),ze={class:"field col-6 md:col-3"},xe=o("label",{for:"zip"},"Qty (Physical)",-1),Ue={key:0,class:"p-invalid text-red-500"},Ge={class:"field col-6 md:col-3"},De=o("label",{for:"zip"},"Qty Adjustment",-1),Me={class:"field col-6 md:col-3"},Ne=o("label",{for:"uom"},"UoM",-1),Le={class:"field col-12 md:col-6 mb-4"},Pe=o("label",{for:"batch"},"Batch",-1),Qe={class:"field col-12 md:col-6 mb-4"},Oe=o("label",{for:"description"},"Description",-1),Re=o("div",{class:"my-5"},null,-1),Ke={__name:"AdjustmentformPage",setup(Je){Y();const D=Z(),g=ee(),a=d({}),h=d([]),B=d([]),f=d([]),y=d([]),j=d([]),w=d([]),k=d([]),C=d([]),A=d([]),M=d(null),u=d(!1),N=d([{label:"Adjustment",route:"/adjustment"},{label:"Add Adjustment"}]);ae(async()=>{}),te(async()=>{M.value=D.currentRoute.value.params.id;try{const s=await fetch(`${c}/api/master/adjustment`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`}}),e=await s.json();if(s.ok)C.value=e.data.data;else throw new Error(e.error||"Failed to fetch storage location data from API");const l=await fetch(`${c}/api/master/material`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`}}),_=await l.json();if(l.ok)A.value=_.data.data;else throw new Error(_.error||"Failed to fetch storage location data from API");const q=await fetch(`${c}/api/master/storage_location`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`}}),$=await q.json();if(q.ok)w.value=$.data.data;else throw new Error($.error||"Failed to fetch storage location data from API");const V=await fetch(`${c}/api/master/storage_bin`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`}}),I=await V.json();if(V.ok)k.value=I.data.data;else throw new Error(I.error||"Failed to fetch storage bin data from API")}catch(s){console.error("Error fetching data from API:",s),g.add({severity:"error",summary:"Error",detail:"Failed to fetch data from API",life:5e3})}});const L=async s=>{try{const e=await fetch(`${c}/api/master/material?search=${s.value}&paginate_count=10`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`}}),l=await e.json();if(e.ok)A.value=l.data.data;else throw new Error(l.error||"Failed to fetch material data from API")}catch{g.add({severity:"error",summary:"Error",detail:"Failed to fetch material",life:5e3})}},P=async s=>{try{const e=await fetch(`${c}/api/master/storage_location?search=${s.value}&paginate_count=10`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`}}),l=await e.json();if(e.ok)w.value=l.data.data;else throw new Error(l.error||"Failed to fetch storage location data from API")}catch{g.add({severity:"error",summary:"Error",detail:"Failed to fetch storage locations",life:5e3})}},Q=async s=>{try{B.value=s.value;const e=await fetch(`${c}/api/master/storage_bin?search=${B.value!=null?B.value:""}&paginate_count=10&s_loc=${h.value.id!=null?h.value.id:""}`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`}}),l=await e.json();if(e.ok)k.value=l.data.data;else throw new Error(l.error||"Failed to fetch storage bin data from API")}catch{g.add({severity:"error",summary:"Error",detail:"Failed to fetch storage bins",life:5e3})}},O=async s=>{const e=A.value.find(l=>l.code===s);if(f.value=e.id,e&&(a.value.uom=e.uom.name),y.value&&f.value)try{const l=await fetch(`${c}/api/adjustment/getfrommatloc?material_id=${f.value!=null?f.value:""}&sbin_id=${y.value!=null?y.value:""}`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`}}),_=await l.json();if(l.ok)j.value=_.data.qty,a.value.qty=j.value??0,console.log(_.data);else throw new Error(_.error||"Failed to fetch storage bin data from API")}catch(l){console.error("Error fetching storage bin data:",l)}},R=async s=>{if(y.value=s,y.value&&f.value)try{const e=await fetch(`${c}/api/adjustment/getfrommatloc?material_id=${f.value!=null?f.value:""}&sbin_id=${y.value!=null?y.value:""}`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`}}),l=await e.json();if(e.ok)console.log(l.data),j.value=l.data.qty,a.value.material_loc_id=l.data.id,a.value.qty=j.value??0;else throw new Error(l.error||"Failed to fetch storage bin data from API")}catch(e){console.error("Error fetching storage bin data:",e)}},J=async s=>{if(h.value=w.value.find(e=>e.name===s),h.value){a.value.sloc_desc=h.value.name;try{const e=await fetch(`${c}/api/master/storage_bin?s_loc=${h.value.id!=null?h.value.id:""}`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`}}),l=await e.json();if(e.ok)k.value=l.data.data;else throw new Error(l.error||"Failed to fetch storage bin data from API")}catch(e){console.error("Error fetching storage bin data:",e)}}},F=(s,e)=>{s!=null&e!=null&&(a.value.qty_adjustment=s-e)};U(()=>a.value.qty_physical,()=>{F(a.value.qty_physical,a.value.qty)}),U(()=>a.value.qty,()=>{F(a.value.qty_physical,a.value.qty)});const H=async()=>{try{const s=await fetch(`${c}/api/adjustment`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({material_loc_id:a.value.material_loc_id,adjustment_id:a.value.adjustment_id.id,qty_physical:a.value.qty_physical,qty_before:a.value.qty,qty_adjustment:a.value.qty_adjustment,batch:a.value.batch,description:a.value.description})}),e=await s.json();if(s.ok)u.value=!1,a.value={},g.add({severity:"success",summary:"Successful",detail:"Data Adjustment Created",life:3e3});else throw new Error(e.error||"Failed to create data Adjustment")}catch(s){g.add({severity:"error",summary:"Error",detail:s,life:5e3})}},K=()=>{u.value=!0,a.value.s_bin&&a.value.s_bin.id!==null&&a.value.material_id&&a.value.material_id.id!==null&&a.value.adjustment_id&&a.value.adjustment_id.id!==null&&a.value.qty_physical&&H()};return(s,e)=>{const l=v("router-link"),_=v("Breadcrumb"),q=v("Toast"),$=v("Button"),V=v("Toolbar"),I=v("Divider"),E=v("Dropdown"),T=v("InputText"),z=v("InputNumber");return n(),i(oe,null,[r(_,{model:N.value},{item:p(({item:t,props:x})=>[t.route?(n(),le(l,{key:0,to:t.route,custom:""},{default:p(({href:W,navigate:X})=>[o("a",G({href:W},x.action,{onClick:X}),[o("span",{class:b([t.icon,"text-color"])},null,2),o("span",ne,m(t.label),1)],16,se)]),_:2},1032,["to"])):(n(),i("a",G({key:1,href:t.url,target:t.target},x.action),[o("span",ie,m(t.label),1)],16,re))]),_:1},8,["model"]),o("div",de,[o("div",ce,[o("div",ue,[r(q),r(V,{class:"mb-4 p-0",style:{border:"none","background-color":"white"}},{start:p(()=>[me]),end:p(()=>[r($,{label:"Save",class:"p-button-primary mr-2 px-6",onClick:K})]),_:1}),r(I),o("div",ve,[o("div",_e,[pe,r(E,{id:"adjustment_id",modelValue:a.value.adjustment_id,"onUpdate:modelValue":e[0]||(e[0]=t=>a.value.adjustment_id=t),options:C.value,optionLabel:"name",placeholder:"Select adjustment",class:b({"p-invalid":u.value&&!a.value.adjustment_id}),required:"true"},{value:p(t=>[t.value&&t.value.id?(n(),i("div",he,m(t.value.name),1)):(n(),i("span",fe,m(t.placeholder),1))]),_:1},8,["modelValue","options","class"]),u.value&&!a.value.adjustment_id?(n(),i("small",ye,"Adjustment is required.")):S("",!0)]),o("div",ge,[be,r(E,{id:"s_loc",modelValue:a.value.s_loc,"onUpdate:modelValue":e[1]||(e[1]=t=>a.value.s_loc=t),options:w.value,optionLabel:"name",onFilter:P,onChange:e[2]||(e[2]=t=>J(a.value.s_loc.name)),filter:"",placeholder:"Select storage location"},{value:p(t=>[t.value&&t.value.id?(n(),i("div",je,m(t.value.name),1)):(n(),i("span",we,m(t.placeholder),1))]),_:1},8,["modelValue","options"])]),o("div",ke,[Ae,r(E,{id:"material_id",modelValue:a.value.material_id,"onUpdate:modelValue":e[3]||(e[3]=t=>a.value.material_id=t),options:A.value,optionLabel:"code",placeholder:"Select material",onChange:e[4]||(e[4]=t=>O(a.value.material_id.code)),class:b({"p-invalid":u.value&&!a.value.material_id}),required:"true",onFilter:L,filter:""},{value:p(t=>[t.value&&t.value.id?(n(),i("div",qe,m(t.value.code),1)):(n(),i("span",$e,m(t.placeholder),1))]),_:1},8,["modelValue","options","class"]),u.value&&!a.value.material_id?(n(),i("small",Ve,"Material is required.")):S("",!0)]),o("div",Ie,[Ee,r(E,{id:"s_bin",modelValue:a.value.s_bin,"onUpdate:modelValue":e[5]||(e[5]=t=>a.value.s_bin=t),options:k.value,optionLabel:"name",onChange:e[6]||(e[6]=t=>R(a.value.s_bin.id)),placeholder:"Select storage bin",class:b({"p-invalid":u.value&&!a.value.s_bin}),required:"true",onFilter:Q,filter:""},{value:p(t=>[t.value&&t.value.id?(n(),i("div",Te,m(t.value.name),1)):(n(),i("span",Se,m(t.placeholder),1))]),_:1},8,["modelValue","options","class"]),u.value&&!a.value.s_bin?(n(),i("small",Be,"Storage bin is required.")):S("",!0)]),o("div",Ce,[Fe,r(T,{id:"qty",modelValue:a.value.qty,"onUpdate:modelValue":e[7]||(e[7]=t=>a.value.qty=t),disabled:""},null,8,["modelValue"])]),o("div",ze,[xe,r(z,{modelValue:a.value.qty_physical,"onUpdate:modelValue":e[8]||(e[8]=t=>a.value.qty_physical=t),inputId:"integeronly",class:b({"p-invalid":u.value&&!a.value.qty_physical})},null,8,["modelValue","class"]),u.value&&!a.value.qty_physical?(n(),i("small",Ue,"Qty is required.")):S("",!0)]),o("div",Ge,[De,r(z,{modelValue:a.value.qty_adjustment,"onUpdate:modelValue":e[9]||(e[9]=t=>a.value.qty_adjustment=t),inputId:"integeronly",disabled:""},null,8,["modelValue"])]),o("div",Me,[Ne,r(T,{id:"uom",modelValue:a.value.uom,"onUpdate:modelValue":e[10]||(e[10]=t=>a.value.uom=t),disabled:""},null,8,["modelValue"])]),o("div",Le,[Pe,r(T,{id:"batch",modelValue:a.value.batch,"onUpdate:modelValue":e[11]||(e[11]=t=>a.value.batch=t)},null,8,["modelValue"])]),o("div",Qe,[Oe,r(T,{id:"description",modelValue:a.value.description,"onUpdate:modelValue":e[12]||(e[12]=t=>a.value.description=t)},null,8,["modelValue"])])]),Re])])])],64)}}};export{Ke as default};
