import{m as te,r as n,u as oe,n as se,l as le,j as _,q as re,d as b,o as p,e as f,f as l,g as i,s as d,v as ne,x as k,y as R,t as j,F as ie,D as de,z as ce}from"./index-2eb3e8c7.js";const ue={class:"grid"},me={class:"col-12"},pe={class:"card"},ve=l("div",{class:"my-2"},[l("h5",{class:"m-0"},"Management Role")],-1),fe={class:"flex flex-column md:flex-row md:justify-content-between md:align-items-center"},he={class:"block mt-2 md:mt-0 p-input-icon-left"},ye=l("i",{class:"pi pi-search"},null,-1),ge=l("div",{class:"flex flex-column md:flex-row md:justify-content-between md:align-items-center",style:{"text-align":"center",width:"100%"}},[l("span",{style:{width:"100%"}},"No")],-1),we=l("div",{class:"flex flex-column md:flex-row md:justify-content-between md:align-items-center",style:{"text-align":"center",width:"90%"}},[l("span",{style:{width:"100%"}},"Nama")],-1),_e=l("div",{class:"flex flex-column md:flex-row md:justify-content-between md:align-items-center",style:{"text-align":"center",width:"100%"}},[l("span",{style:{width:"100%"}},"Action")],-1),be=["onClick"],ke=["onClick"],Ce=["onClick"],xe={class:"field"},Pe={key:0,class:"p-invalid",style:{color:"red"}},Fe=["for"],Te={class:"field"},$e=l("label",{for:"name"},"Name",-1),Se={key:0,class:"p-invalid"},Ee={class:"flex align-items-center justify-content-center"},De=l("i",{class:"pi pi-exclamation-triangle mr-3",style:{"font-size":"2rem"}},null,-1),Re={key:0},Ae={__name:"RolePage",setup(je){const U=te(),h=n(null),m=oe(),I=n([]),P=n(""),C=n(!1),F=n(!1),T=n(!1),r=n({}),y=n({}),c=n(null),$=n({}),g=n(!1),S=n(null),w=n(null),A=n([]),N=n([]),E=n(null),B=n(null),O=n(null),x=async a=>{a.page+=1;try{const e=await fetch(`${_}/api/roles?page=${a.page}&sortField=${a.sortField}&sortOrder=${a.sortOrder}&search=${w.value!=null?w.value:""}&paginate_count=${a.rows}`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`}}),o=await e.json();if(S.value=o.data.total,e.ok)I.value=o.data;else throw new Error(o.error||"Failed to fetch data from API")}catch{m.add({severity:"error",summary:"Error",detail:"Failed to fetch data from API",life:5e3})}},M=a=>{var e,o,s;a.target.value?w.value=a.target.value:w.value="",x({page:0,search:w.value,sortField:(e=c.value)==null?void 0:e.sortField,sortOrder:(o=c.value)==null?void 0:o.sortOrder,rows:(s=c.value)==null?void 0:s.rows})};se(()=>{const a=U.state.permission;a!==null?(h.value=a,E.value=h.value.some(e=>e.name==="create-role"),B.value=h.value.some(e=>e.name==="edit-role"),O.value=h.value.some(e=>e.name==="delete-role")):U.watch(e=>e.permission,e=>{h.value=e,E.value=h.value.some(o=>o.name==="create-role"),B.value=h.value.some(o=>o.name==="edit-role"),O.value=h.value.some(o=>o.name==="delete-role")}),Z()}),le(async()=>{try{const a=await fetch(`${_}/api/roles`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`}}),e=await a.json();if(a.ok)I.value=e.data,S.value=e.data.total;else throw new Error(e.error||"Failed to fetch data from API");const o=await fetch(`${_}/api/permissions`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`}}),s=await o.json();if(o.ok)A.value=s.data;else throw new Error(s.error||"Failed to fetch storage bin data from API")}catch{m.add({severity:"error",summary:"Error",detail:"Failed to fetch data from API",life:5e3})}});const G=()=>{r.value={},g.value=!1,C.value=!0,P.value="Add New Role"},L=()=>{C.value=!1,F.value=!1,g.value=!1},q=async()=>{var e,o,s;let a="Failed to updated data Role";try{const u=await(await fetch(`${_}/api/roles/${r.value.id}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({name:r.value.name})})).json();if(u.success===!0)await x({page:0,search:w.value,sortField:(e=c.value)==null?void 0:e.sortField,sortOrder:(o=c.value)==null?void 0:o.sortOrder,rows:(s=c.value)==null?void 0:s.rows}),m.add({severity:"success",summary:"Successful",detail:"Data Role Updated",life:3e3});else throw u.message.name[0]&&(a=u.message.name[0]),new Error(u.error||"Failed to updated Role")}catch{m.add({severity:"error",summary:"Error",detail:a,life:5e3})}},J=async()=>{var e,o,s;let a="Failed to create data Role";try{const u=await(await fetch(`${_}/api/roles`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({name:r.value.name})})).json();if(u.success===!0)await x({page:0,search:w.value,sortField:(e=c.value)==null?void 0:e.sortField,sortOrder:(o=c.value)==null?void 0:o.sortOrder,rows:(s=c.value)==null?void 0:s.rows}),m.add({severity:"success",summary:"Successful",detail:"Data Role Created",life:3e3});else throw u.message.name[0]&&(a=u.message.name[0]),new Error(u.error||"Failed to create Role")}catch{m.add({severity:"error",summary:"Error",detail:a,life:5e3})}},H=()=>{g.value=!0,r.value.name&&r.value.name.trim()&&(r.value.id?q():J(),C.value=!1,r.value={})},K=a=>{r.value={...a},C.value=!0,P.value="Edit Role"},Y=a=>{r.value=a,T.value=!0},Q=async()=>{var a,e,o;try{const v=await(await fetch(`${_}/api/roles/${r.value.id}`,{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`}})).json();if(console.log(v),v.success===!0)await x({page:0,search:w.value,sortField:(a=c.value)==null?void 0:a.sortField,sortOrder:(e=c.value)==null?void 0:e.sortOrder,rows:(o=c.value)==null?void 0:o.rows}),T.value=!1,r.value={},m.add({severity:"success",summary:"Successful",detail:"Role Deleted",life:3e3});else throw new Error(v.error||"Failed to delete Role")}catch{m.add({severity:"error",summary:"Error",detail:"Failed to delete Role",life:5e3})}},W=async a=>{g.value=!0;const e=await fetch(`${_}/api/roles/${a.id}`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`}}),o=await e.json();if(e.ok)console.log("111",A),N.value=o.data,console.log("222",N);else throw new Error(o.error||"Failed to fetch storage bin data from API");y.value.permis=N.value.map(s=>s.name),y.value.id=a.id,F.value=!0,P.value="Role Permission"},X=async()=>{try{const e=await(await fetch(`${_}/api/roles/${y.value.id}/permissions`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({permissions:y.value.permis})})).json();if(e.success===!0)m.add({severity:"success",summary:"Successful",detail:"Permission Updated",life:3e3}),F.value=!1,y.value={},g.value=!1;else throw new Error(e.error||"Failed to updated Permission")}catch{m.add({severity:"error",summary:"Error",detail:"Failed to updated Permission",life:5e3})}},Z=()=>{$.value={global:{value:null,matchMode:re.CONTAINS}}};return(a,e)=>{const o=b("Toast"),s=b("Button"),v=b("Toolbar"),u=b("InputText"),V=b("Column"),ee=b("DataTable"),ae=b("Checkbox"),z=b("Dialog");return p(),f("div",ue,[l("div",me,[l("div",pe,[i(o),i(v,{class:"mb-4 p-0",style:{border:"none","background-color":"white"}},{start:d(()=>[ve]),end:d(()=>[E.value?(p(),ne(s,{key:0,label:"Add New",icon:"pi pi-plus-circle",class:"p-button-primary mr-2",onClick:G})):k("",!0)]),_:1}),i(ee,{ref_key:"dt",ref:c,value:I.value.data,lazy:"",filters:$.value,first:a.first,onPage:e[2]||(e[2]=t=>x(t)),last:S.value,loading:a.loading,totalRecords:S.value,dataKey:"id",class:"p-datatable-gridlines",paginator:!0,onSort:e[3]||(e[3]=t=>x(t)),rows:10,paginatorTemplate:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",rowsPerPageOptions:[5,10,25],currentPageReportTemplate:"Showing {first} to {last} of {totalRecords} datamaster",responsiveLayout:"scroll"},{header:d(()=>[l("div",fe,[l("span",he,[ye,i(u,{modelValue:$.value.global.value,"onUpdate:modelValue":e[0]||(e[0]=t=>$.value.global.value=t),placeholder:"Search...",onInput:e[1]||(e[1]=t=>M(t))},null,8,["modelValue"])])])]),default:d(()=>[i(V,{field:"rowIndex",headerStyle:"min-width:5%;",style:{"text-align":"center"}},{header:d(()=>[ge]),body:d(t=>[R(j(t.index+1),1)]),_:1}),i(V,{field:"name",headerStyle:"width:65%;"},{header:d(()=>[we]),body:d(t=>[R(j(t.data.name),1)]),_:1}),i(V,{style:{"text-align":"center"},headerStyle:"width:30%;"},{header:d(()=>[_e]),body:d(t=>[E.value?(p(),f("span",{key:0,onClick:D=>W(t.data),style:{cursor:"pointer",color:"#0EA5E9"},class:"mr-3"},"Permission",8,be)):k("",!0),B.value?(p(),f("span",{key:1,onClick:D=>K(t.data),style:{cursor:"pointer",color:"#5e42ce"},class:"mr-3"},"Edit",8,ke)):k("",!0),O.value?(p(),f("span",{key:2,onClick:D=>Y(t.data),style:{cursor:"pointer",color:"#ff5742"}},"Delete",8,Ce)):k("",!0)]),_:1})]),_:1},8,["value","filters","first","last","loading","totalRecords"]),i(z,{visible:F.value,"onUpdate:visible":e[4]||(e[4]=t=>F.value=t),style:{width:"450px"},header:P.value,modal:!0,class:"p-fluid"},{footer:d(()=>[i(s,{label:"Cancel",icon:"pi pi-times",onClick:L,style:{background:"white",color:"blue"}}),i(s,{label:"Save",icon:"pi pi-check",class:"p-button-primary",onClick:X})]),default:d(()=>[l("div",xe,[g.value&&y.value.permis.length==0?(p(),f("small",Pe,"Role minimal 1.")):k("",!0),(p(!0),f(ie,null,de(A.value,t=>(p(),f("div",{key:t.id,class:"flex align-items-center mb-2 justify-content-between"},[l("label",{for:t.id,class:"ml-2"},j(t.name),9,Fe),i(ae,{modelValue:y.value.permis,"onUpdate:modelValue":D=>y.value.permis=D,inputId:t.id,name:t.name,value:t.name},null,8,["modelValue","onUpdate:modelValue","inputId","name","value"])]))),128))])]),_:1},8,["visible","header"]),i(z,{visible:C.value,"onUpdate:visible":e[6]||(e[6]=t=>C.value=t),style:{width:"450px"},header:P.value,modal:!0,class:"p-fluid"},{footer:d(()=>[i(s,{label:"Cancel",icon:"pi pi-times",onClick:L,style:{background:"white",color:"blue"}}),i(s,{label:"Save",icon:"pi pi-check",class:"p-button-primary",onClick:H})]),default:d(()=>[l("div",Te,[$e,i(u,{id:"name",modelValue:r.value.name,"onUpdate:modelValue":e[5]||(e[5]=t=>r.value.name=t),modelModifiers:{trim:!0},required:"true",autofocus:"",class:ce({"p-invalid":g.value&&!r.value.name})},null,8,["modelValue","class"]),g.value&&!r.value.name?(p(),f("small",Se,"Name is required.")):k("",!0)])]),_:1},8,["visible","header"]),i(z,{visible:T.value,"onUpdate:visible":e[8]||(e[8]=t=>T.value=t),style:{width:"450px"},header:"Confirm",modal:!0},{footer:d(()=>[i(s,{label:"No",icon:"pi pi-times",style:{background:"white",color:"red",borderColor:"red"},onClick:e[7]||(e[7]=t=>T.value=!1)}),i(s,{label:"Yes",icon:"pi pi-check",class:"p-button-primary",onClick:Q})]),default:d(()=>[l("div",Ee,[De,r.value?(p(),f("span",Re,[R("Are you sure you want to delete "),l("b",null,j(r.value.name),1),R("?")])):k("",!0)])]),_:1},8,["visible"])])])])}}};export{Ae as default};
