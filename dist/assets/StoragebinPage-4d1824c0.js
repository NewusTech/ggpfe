import{m as ae,r as d,u as te,n as oe,l as le,j as p,q as se,d as b,o as m,e as g,f as r,g as i,s as n,v as L,x as k,y as S,t as v,z as O}from"./index-2eb3e8c7.js";const re={class:"grid mt-1"},ne={class:"col-12"},ie={class:"card"},de=r("div",{class:"my-2"},[r("h5",{class:"m-0"},"Master Storage Bin")],-1),ce={class:"flex flex-column md:flex-row md:justify-content-between md:align-items-center"},ue={class:"block mt-2 md:mt-0 p-input-icon-left"},me=r("i",{class:"pi pi-search"},null,-1),pe=r("div",{class:"flex flex-column md:flex-row md:justify-content-between md:align-items-center",style:{"text-align":"center",width:"100%"}},[r("span",{style:{width:"100%"}},"No")],-1),ve=r("div",{class:"flex flex-column md:flex-row md:justify-content-between md:align-items-center",style:{"text-align":"center",width:"90%"}},[r("span",{style:{width:"100%"}},"Storage Bin")],-1),he=r("div",{class:"flex flex-column md:flex-row md:justify-content-between md:align-items-center",style:{"text-align":"center",width:"90%"}},[r("span",{style:{width:"100%"}},"Storage Location")],-1),fe=r("div",{class:"flex flex-column md:flex-row md:justify-content-between md:align-items-center",style:{"text-align":"center",width:"90%"}},[r("span",{style:{width:"100%"}},"Storage Location Desc")],-1),ge=r("div",{class:"flex flex-column md:flex-row md:justify-content-between md:align-items-center",style:{"text-align":"center",width:"90%"}},[r("span",{style:{width:"100%"}},"Plant")],-1),_e=r("div",{class:"flex flex-column md:flex-row md:justify-content-between md:align-items-center",style:{"text-align":"center",width:"100%"}},[r("span",{style:{width:"100%"}},"Action")],-1),ye={class:"flex justify-center-between",style:{width:"100%"}},we={class:"field",style:{width:"49%"}},be=r("label",{for:"name",class:"mb-3"},"Storage Bin",-1),ke={key:0,class:"p-invalid"},Se={class:"field",style:{width:"49%","margin-left":"auto"}},xe=r("label",{for:"plant_id",class:"mb-3"},"Plant",-1),Te={key:0},Ce={key:1},$e={key:0,class:"p-invalid"},je={class:"flex justify-center-between",style:{width:"100%"}},Be={class:"field",style:{width:"49%"}},Fe=r("label",{for:"s_loc",class:"mb-3"},"Storage Location",-1),Pe={key:0},Ee={key:1},De={key:0,class:"p-invalid"},Ie={class:"flex align-items-center justify-content-center"},Ae=r("i",{class:"pi pi-exclamation-triangle mr-3",style:{"font-size":"2rem"}},null,-1),Ve={key:0},ze={__name:"StoragebinPage",setup(Le){const z=ae(),_=d(null),h=te(),P=d(null),E=d(null),D=d(null),I=d([]),A=d(""),x=d(!1),C=d(!1),t=d({}),c=d(null),$=d({}),f=d(!1),V=d([]),y=d(null),j=d(null),B=d([]),T=async l=>{l.page+=1;try{const e=`${p}/api/master/storage_bin?page=${l.page}&sortField=${l.sortField}&sortOrder=${l.sortOrder}&search=${y.value!=null?y.value:""}&paginate_count=${l.rows}`,s=await fetch(e,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`}}),o=await s.json();if(j.value=o.data.total,s.ok)I.value=o.data;else throw new Error(o.error||"Failed to fetch data from API")}catch{h.add({severity:"error",summary:"Error",detail:"Failed to fetch data from API",life:5e3})}},M=l=>{var e,s,o;l.target.value?y.value=l.target.value:y.value="",T({page:0,search:y.value,sortField:(e=c.value)==null?void 0:e.sortField,sortOrder:(s=c.value)==null?void 0:s.sortOrder,rows:(o=c.value)==null?void 0:o.rows})};oe(()=>{const l=z.state.permission;l!==null?(_.value=l,P.value=_.value.some(e=>e.name==="create-master"),E.value=_.value.some(e=>e.name==="edit-master"),D.value=_.value.some(e=>e.name==="delete-master")):z.watch(e=>e.permission,e=>{_.value=e,P.value=_.value.some(s=>s.name==="create-master"),E.value=_.value.some(s=>s.name==="edit-master"),D.value=_.value.some(s=>s.name==="delete-master")}),X()}),le(async()=>{try{const l=`${p}/api/master/storage_bin`,e=await fetch(l,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`}}),s=await e.json();if(e.ok)I.value=s.data,j.value=s.data.total;else throw new Error(s.error||"Failed to fetch data from API");const o=await fetch(`${p}/api/master/plant`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`}}),u=await o.json();if(o.ok)V.value=u.data.data;else throw new Error(u.error||"Failed to fetch plant data from API")}catch{h.add({severity:"error",summary:"Error",detail:"Failed to fetch data from API",life:5e3})}});const q=async()=>{t.value={};const l=await fetch(`${p}/api/master/storage_location`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`}}),e=await l.json();if(l.ok)B.value=e.data.data;else throw new Error(e.error||"Failed to fetch storage location data from API");f.value=!1,x.value=!0,A.value="Add New Storage Bin"},G=()=>{x.value=!1,f.value=!1},R=async()=>{var l,e,s;try{const o=await fetch(`${p}/api/master/storage_bin/${t.value.id}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({name:t.value.name,sloc_id:t.value.s_loc.id,plant_id:t.value.plant_id.id})}),u=await o.json();if(o.ok)await T({page:0,search:y.value,sortField:(l=c.value)==null?void 0:l.sortField,sortOrder:(e=c.value)==null?void 0:e.sortOrder,rows:(s=c.value)==null?void 0:s.rows}),h.add({severity:"success",summary:"Successful",detail:"Data Storage Bin Updated",life:3e3});else throw new Error(u.error||"Failed to update data Storage Bin")}catch(o){h.add({severity:"error",summary:"Failed",detail:o,life:5e3})}},J=async()=>{var l,e,s;try{const o=await fetch(`${p}/api/master/storage_bin`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({name:t.value.name,sloc_id:t.value.s_loc.id,plant_id:t.value.plant_id.id})}),u=await o.json();if(o.ok)await T({page:0,search:y.value,sortField:(l=c.value)==null?void 0:l.sortField,sortOrder:(e=c.value)==null?void 0:e.sortOrder,rows:(s=c.value)==null?void 0:s.rows}),h.add({severity:"success",summary:"Successful",detail:"Data Storage Bin Created",life:3e3});else throw new Error(u.error||"Failed to create data Storage Bin")}catch(o){h.add({severity:"error",summary:"Failed",detail:o,life:5e3})}},H=async l=>{try{const e=await fetch(`${p}/api/master/storage_location?search=${l.value}&paginate_count=15`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`}}),s=await e.json();if(e.ok)B.value=s.data.data;else throw new Error(s.error||"Failed to fetch storage location data from API")}catch{h.add({severity:"error",summary:"Error",detail:"Failed to fetch storage locations",life:5e3})}},K=()=>{f.value=!0,t.value.name&&t.value.name.trim()&&t.value.plant_id.id!==null&&t.value.s_loc&&t.value.s_loc.id!==null&&(t.value.id?R():J(),x.value=!1,t.value={})},Y=async l=>{t.value={...l};const e=await fetch(`${p}/api/master/storage_location`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`}}),s=await e.json();if(e.ok)B.value=s.data.data;else throw new Error(s.error||"Failed to fetch storage location data from API");console.log(t.value);const o=await fetch(`${p}/api/master/storage_location?search=${t.value.sloc.name}`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`}}),u=await o.json();o.ok&&(t.value.s_loc=u.data.data[0]);const F=V.value.find(w=>w.id===t.value.plant_id);t.value.plant_id=F,x.value=!0,A.value="Edit Storage Bin"},Q=l=>{t.value=l,C.value=!0},W=async()=>{var l,e,s;try{const o=await fetch(`${p}/api/master/storage_bin/${t.value.id}`,{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`}}),u=await o.json();if(o.ok)await T({page:0,search:y.value,sortField:(l=c.value)==null?void 0:l.sortField,sortOrder:(e=c.value)==null?void 0:e.sortOrder,rows:(s=c.value)==null?void 0:s.rows}),C.value=!1,t.value={},h.add({severity:"success",summary:"Successful",detail:"Storage Bin Deleted",life:3e3});else throw o.status===500&&u.error.includes("Integrity constraint violation")?new Error("Tidak dapat hapus data ini, karena masih digunakan pada data lain"):new Error(u.error||"Failed to delete Storage Bin")}catch(o){h.add({severity:"error",summary:"Error",detail:o.message,life:5e3})}},X=()=>{$.value={global:{value:null,matchMode:se.CONTAINS}}};return(l,e)=>{const s=b("Toast"),o=b("Button"),u=b("Toolbar"),F=b("InputText"),w=b("Column"),Z=b("DataTable"),N=b("Dropdown"),U=b("Dialog");return m(),g("div",re,[r("div",ne,[r("div",ie,[i(s),i(u,{class:"mb-4 p-0",style:{border:"none","background-color":"white"}},{start:n(()=>[de]),end:n(()=>[P.value?(m(),L(o,{key:0,label:"Add New",icon:"pi pi-plus-circle",class:"p-button-primary mr-2",onClick:q})):k("",!0)]),_:1}),i(Z,{ref_key:"dt",ref:c,value:I.value.data,lazy:"",filters:$.value,first:l.first,onPage:e[2]||(e[2]=a=>T(a)),last:j.value,loading:l.loading,totalRecords:j.value,dataKey:"id",class:"p-datatable-gridlines",paginator:!0,onSort:e[3]||(e[3]=a=>T(a)),rows:10,paginatorTemplate:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",rowsPerPageOptions:[5,10,25],currentPageReportTemplate:"Showing {first} to {last} of {totalRecords} datamaster",responsiveLayout:"scroll"},{header:n(()=>[r("div",ce,[r("span",ue,[me,i(F,{modelValue:$.value.global.value,"onUpdate:modelValue":e[0]||(e[0]=a=>$.value.global.value=a),placeholder:"Search...",onInput:e[1]||(e[1]=a=>M(a))},null,8,["modelValue"])])])]),default:n(()=>[i(w,{field:"rowIndex",headerStyle:"min-width:5%;",style:{"text-align":"center"}},{header:n(()=>[pe]),body:n(a=>[S(v(a.index+1),1)]),_:1}),i(w,{field:"name",headerStyle:"width:20%;"},{header:n(()=>[ve]),body:n(a=>[S(v(a.data.name),1)]),_:1}),i(w,{field:"sloc.name",headerStyle:"width:20%;"},{header:n(()=>[he]),body:n(a=>[S(v(a.data.sloc.name),1)]),_:1}),i(w,{field:"sloc.desc",headerStyle:"width:25%;"},{header:n(()=>[fe]),body:n(a=>[S(v(a.data.sloc.desc),1)]),_:1}),i(w,{field:"plant.name",headerStyle:"width:15%;"},{header:n(()=>[ge]),body:n(a=>[S(v(a.data.plant.name),1)]),_:1}),i(w,{style:{"text-align":"center"},headerStyle:"width:15%;"},{header:n(()=>[_e]),body:n(a=>[E.value?(m(),L(o,{key:0,icon:"pi pi-file-edit",class:"p-button-text p-button-primary mt-2",onClick:ee=>Y(a.data)},null,8,["onClick"])):k("",!0),D.value?(m(),L(o,{key:1,icon:"pi pi-trash",class:"p-button-text p-button-danger mt-2",onClick:ee=>Q(a.data)},null,8,["onClick"])):k("",!0)]),_:1})]),_:1},8,["value","filters","first","last","loading","totalRecords"]),i(U,{visible:x.value,"onUpdate:visible":e[7]||(e[7]=a=>x.value=a),style:{width:"750px"},header:A.value,modal:!0,class:"p-fluid"},{footer:n(()=>[i(o,{label:"Cancel",icon:"pi pi-times",onClick:G,style:{background:"white",color:"blue"}}),i(o,{label:"Save",icon:"pi pi-check",class:"p-button-primary",onClick:K})]),default:n(()=>[r("div",ye,[r("div",we,[be,i(F,{id:"name",modelValue:t.value.name,"onUpdate:modelValue":e[4]||(e[4]=a=>t.value.name=a),modelModifiers:{trim:!0},required:"true",autofocus:"",class:O({"p-invalid":f.value&&!t.value.name})},null,8,["modelValue","class"]),f.value&&!t.value.name?(m(),g("small",ke,"Storage bin is required.")):k("",!0)]),r("div",Se,[xe,i(N,{id:"plant_id",modelValue:t.value.plant_id,"onUpdate:modelValue":e[5]||(e[5]=a=>t.value.plant_id=a),options:V.value,optionLabel:"name",placeholder:"Select a plant",class:O({"p-invalid":f.value&&!t.value.plant_id}),required:"true"},{value:n(a=>[a.value&&a.value.id?(m(),g("div",Te,v(a.value.name),1)):(m(),g("span",Ce,v(a.placeholder),1))]),_:1},8,["modelValue","options","class"]),f.value&&!t.value.plant_id?(m(),g("small",$e,"Plant is required.")):k("",!0)])]),r("div",je,[r("div",Be,[Fe,i(N,{id:"s_loc",modelValue:t.value.s_loc,"onUpdate:modelValue":e[6]||(e[6]=a=>t.value.s_loc=a),options:B.value,optionLabel:"name",placeholder:"Select storage location",class:O({"p-invalid":f.value&&!t.value.s_loc}),required:"true",onFilter:H,filter:""},{value:n(a=>[a.value&&a.value.id?(m(),g("div",Pe,v(a.value.name),1)):(m(),g("span",Ee,v(a.placeholder),1))]),_:1},8,["modelValue","options","class"]),f.value&&!t.value.s_loc?(m(),g("small",De,"Storage Location is required.")):k("",!0)])])]),_:1},8,["visible","header"]),i(U,{visible:C.value,"onUpdate:visible":e[9]||(e[9]=a=>C.value=a),style:{width:"450px"},header:"Confirm",modal:!0},{footer:n(()=>[i(o,{label:"No",icon:"pi pi-times",style:{background:"white",color:"red",borderColor:"red"},onClick:e[8]||(e[8]=a=>C.value=!1)}),i(o,{label:"Yes",icon:"pi pi-check",class:"p-button-primary",onClick:W})]),default:n(()=>[r("div",Ie,[Ae,t.value?(m(),g("span",Ve,[S("Are you sure you want to delete "),r("b",null,v(t.value.name),1),S("?")])):k("",!0)])]),_:1},8,["visible"])])])])}}};export{ze as default};
