import{m as W,r as i,u as X,n as Z,l as ee,j as k,q as ae,d as f,o as g,e as N,f as r,g as d,s as n,v as E,x,y as w,t as j,z as te}from"./index-2eb3e8c7.js";const oe={class:"grid"},se={class:"col-12"},le={class:"card"},re=r("div",{class:"my-2"},[r("h5",{class:"m-0"},"Master UoM")],-1),ne={class:"flex flex-column md:flex-row md:justify-content-between md:align-items-center"},ie={class:"block mt-2 md:mt-0 p-input-icon-left"},de=r("i",{class:"pi pi-search"},null,-1),ue=r("div",{class:"flex flex-column md:flex-row md:justify-content-between md:align-items-center",style:{"text-align":"center",width:"100%"}},[r("span",{style:{width:"100%"}},"No")],-1),ce=r("div",{class:"flex flex-column md:flex-row md:justify-content-between md:align-items-center",style:{"text-align":"right",width:"50%"}},[r("span",{style:{width:"100%"}},"Name")],-1),me=r("div",{class:"flex flex-column md:flex-row md:justify-content-between md:align-items-center",style:{"text-align":"center",width:"100%"}},[r("span",{style:{width:"100%"}},"Action")],-1),ve={class:"field"},pe=r("label",{for:"name"},"Name",-1),fe={key:0,class:"p-invalid"},he={class:"flex align-items-center justify-content-center"},ye=r("i",{class:"pi pi-exclamation-triangle mr-3",style:{"font-size":"2rem"}},null,-1),ge={key:0},be={__name:"UomPage",setup(we){const U=W(),c=i(null),m=X(),T=i(null),D=i(null),S=i(null),F=i([]),$=i(""),h=i(!1),_=i(!1),l=i({}),u=i(null),C=i(null),v=i(null),P=i({}),b=i(!1),A=i(!1);Z(()=>{const a=U.state.permission;a!==null?(c.value=a,T.value=c.value.some(e=>e.name==="create-master"),D.value=c.value.some(e=>e.name==="edit-master"),S.value=c.value.some(e=>e.name==="delete-master")):U.watch(e=>e.permission,e=>{c.value=e,T.value=c.value.some(o=>o.name==="create-master"),D.value=c.value.some(o=>o.name==="edit-master"),S.value=c.value.some(o=>o.name==="delete-master")}),K()});const y=async a=>{a.page+=1;try{const e=await fetch(`${k}/api/master/uom?page=${a.page}&sortField=${a.sortField}&sortOrder=${a.sortOrder}&search=${v.value!=null?v.value:""}&paginate_count=${a.rows}`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`}}),o=await e.json();if(C.value=o.data.total,e.ok)F.value=o.data;else throw new Error(o.error||"Failed to fetch data from API")}catch{m.add({severity:"error",summary:"Error",detail:"Failed to fetch data from API",life:5e3})}},B=a=>{var e,o,t;a.target.value?v.value=a.target.value:v.value="",y({page:0,search:v.value,sortField:(e=u.value)==null?void 0:e.sortField,sortOrder:(o=u.value)==null?void 0:o.sortOrder,rows:(t=u.value)==null?void 0:t.rows})};ee(async()=>{try{const a=await fetch(`${k}/api/master/uom`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`}}),e=await a.json();if(a.ok)F.value=e.data,C.value=e.data.total;else throw new Error(e.error||"Failed to fetch data from API")}catch{m.add({severity:"error",summary:"Error",detail:"Failed to fetch data from API",life:5e3})}});const L=()=>{l.value={},b.value=!1,h.value=!0,$.value="Add New UoM"},V=()=>{h.value=!1,b.value=!1},z=async()=>{var a,e,o;try{const t=await fetch(`${k}/api/master/uom/${l.value.id}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({name:l.value.name})}),p=await t.json();if(t.ok)await y({page:0,search:v.value,sortField:(a=u.value)==null?void 0:a.sortField,sortOrder:(e=u.value)==null?void 0:e.sortOrder,rows:(o=u.value)==null?void 0:o.rows}),m.add({severity:"success",summary:"Successful",detail:"Data UoM Updated",life:3e3});else throw new Error(p.error||"Failed to update data UoM")}catch(t){m.add({severity:"error",summary:"Failed",detail:t,life:5e3})}},R=async()=>{var a,e,o;try{const t=await fetch(`${k}/api/master/uom`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({name:l.value.name})}),p=await t.json();if(t.ok)y({page:0,search:v.value,sortField:(a=u.value)==null?void 0:a.sortField,sortOrder:(e=u.value)==null?void 0:e.sortOrder,rows:(o=u.value)==null?void 0:o.rows}),m.add({severity:"success",summary:"Successful",detail:"Data UoM Created",life:3e3});else throw new Error(p.error||"Failed to create data UoM")}catch(t){m.add({severity:"error",summary:"Failed",detail:t,life:5e3})}},q=()=>{b.value=!0,l.value.name&&l.value.name.trim()&&(l.value.id?z():R(),h.value=!1,l.value={})},G=a=>{l.value={...a},h.value=!0,$.value="Edit UoM"},J=a=>{l.value=a,_.value=!0},H=async()=>{var a,e,o;try{const t=await fetch(`${k}/api/master/uom/${l.value.id}`,{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`}}),p=await t.json();if(t.ok)y({page:0,search:v.value,sortField:(a=u.value)==null?void 0:a.sortField,sortOrder:(e=u.value)==null?void 0:e.sortOrder,rows:(o=u.value)==null?void 0:o.rows}),_.value=!1,l.value={},m.add({severity:"success",summary:"Successful",detail:"Data UoM Deleted",life:3e3});else throw t.status===500&&p.error.includes("Integrity constraint violation")?new Error("Tidak dapat hapus data ini, karena masih digunakan pada data lain"):new Error(p.error||"Failed to delete Storage Location")}catch(t){m.add({severity:"error",summary:"Error",detail:t.message,life:5e3})}},K=()=>{P.value={global:{value:null,matchMode:ae.CONTAINS}}};return(a,e)=>{const o=f("Toast"),t=f("Button"),p=f("Toolbar"),I=f("InputText"),M=f("Column"),Y=f("DataTable"),O=f("Dialog");return g(),N("div",oe,[r("div",se,[r("div",le,[d(o),d(p,{class:"mb-4 p-0",style:{border:"none","background-color":"white"}},{start:n(()=>[re]),end:n(()=>[T.value?(g(),E(t,{key:0,label:"Add New",icon:"pi pi-plus-circle",class:"p-button-primary mr-2",onClick:L})):x("",!0)]),_:1}),d(Y,{ref_key:"dt",ref:u,value:F.value.data,lazy:"",filters:P.value,first:a.first,onPage:e[2]||(e[2]=s=>y(s)),last:C.value,loading:A.value,totalRecords:C.value,dataKey:"id",class:"p-datatable-gridlines",paginator:!0,onSort:e[3]||(e[3]=s=>y(s)),rows:10,paginatorTemplate:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",rowsPerPageOptions:[5,10,25],currentPageReportTemplate:"Showing {first} to {last} of {totalRecords} datamaster",responsiveLayout:"scroll"},{header:n(()=>[r("div",ne,[r("span",ie,[de,d(I,{modelValue:P.value.global.value,"onUpdate:modelValue":e[0]||(e[0]=s=>P.value.global.value=s),placeholder:"Search...",onInput:e[1]||(e[1]=s=>B(s))},null,8,["modelValue"])])])]),empty:n(()=>[w(" No data found. ")]),loading:n(()=>[w(" Loading customers data. Please wait. ")]),default:n(()=>[d(M,{field:"rowIndex",headerStyle:"min-width:5%;",style:{"text-align":"center"}},{header:n(()=>[ue]),body:n(s=>[w(j(s.index+1),1)]),_:1}),d(M,{field:"name",headerStyle:"width:60%; min-width:10rem;"},{header:n(()=>[ce]),body:n(s=>[w(j(s.data.name),1)]),_:1}),d(M,{headerStyle:"min-width:10rem;",style:{"text-align":"center"}},{header:n(()=>[me]),body:n(s=>[D.value?(g(),E(t,{key:0,icon:"pi pi-file-edit",class:"p-button-text p-button-primary mt-2",onClick:Q=>G(s.data)},null,8,["onClick"])):x("",!0),S.value?(g(),E(t,{key:1,icon:"pi pi-trash",class:"p-button-text p-button-danger mt-2",onClick:Q=>J(s.data)},null,8,["onClick"])):x("",!0)]),_:1})]),_:1},8,["value","filters","first","last","loading","totalRecords"]),d(O,{visible:h.value,"onUpdate:visible":e[5]||(e[5]=s=>h.value=s),style:{width:"450px"},header:$.value,modal:!0,class:"p-fluid"},{footer:n(()=>[d(t,{label:"Cancel",icon:"pi pi-times",onClick:V,style:{background:"white",color:"blue"}}),d(t,{label:"Save",icon:"pi pi-check",class:"p-button-primary",onClick:q})]),default:n(()=>[r("div",ve,[pe,d(I,{id:"name",modelValue:l.value.name,"onUpdate:modelValue":e[4]||(e[4]=s=>l.value.name=s),modelModifiers:{trim:!0},required:"true",autofocus:"",class:te({"p-invalid":b.value&&!l.value.name})},null,8,["modelValue","class"]),b.value&&!l.value.name?(g(),N("small",fe,"Name is required.")):x("",!0)])]),_:1},8,["visible","header"]),d(O,{visible:_.value,"onUpdate:visible":e[7]||(e[7]=s=>_.value=s),style:{width:"450px"},header:"Confirm",modal:!0},{footer:n(()=>[d(t,{label:"No",icon:"pi pi-times",style:{background:"white",color:"red",borderColor:"red"},onClick:e[6]||(e[6]=s=>_.value=!1)}),d(t,{label:"Yes",icon:"pi pi-check",class:"p-button-primary",onClick:H})]),default:n(()=>[r("div",he,[ye,l.value?(g(),N("span",ge,[w("Are you sure you want to delete "),r("b",null,j(l.value.name),1),w("?")])):x("",!0)])]),_:1},8,["visible"])])])])}}};export{be as default};
