import{m as Q,r as n,u as W,n as X,l as Z,j as _,q as ee,d as f,o as g,e as $,f as l,g as i,s as d,v as E,x as k,y as x,t as I,z as te}from"./index-2eb3e8c7.js";const ae={class:"grid"},se={class:"col-12"},oe={class:"card"},re=l("div",{class:"my-2"},[l("h5",{class:"m-0"},"Master Adjustment Category")],-1),le={class:"flex flex-column md:flex-row md:justify-content-between md:align-items-center"},ne={class:"block mt-2 md:mt-0 p-input-icon-left"},ie=l("i",{class:"pi pi-search"},null,-1),de=l("div",{class:"flex flex-column md:flex-row md:justify-content-between md:align-items-center",style:{"text-align":"center",width:"100%"}},[l("span",{style:{width:"100%"}},"No")],-1),ue=l("div",{class:"flex flex-column md:flex-row md:justify-content-between md:align-items-center",style:{"text-align":"right",width:"50%"}},[l("span",{style:{width:"100%"}},"Name")],-1),ce=l("div",{class:"flex flex-column md:flex-row md:justify-content-between md:align-items-center",style:{"text-align":"center",width:"100%"}},[l("span",{style:{width:"100%"}},"Action")],-1),me={class:"field"},ve=l("label",{for:"name"},"Adjustment Category",-1),pe={key:0,class:"p-invalid"},fe={class:"flex align-items-center justify-content-center"},ye=l("i",{class:"pi pi-exclamation-triangle mr-3",style:{"font-size":"2rem"}},null,-1),he={key:0},be={__name:"AdjcategoryPage",setup(ge){const N=Q(),c=n(null),m=W(),A=n(null),P=n(null),T=n(null),D=n([]),F=n(""),y=n(!1),w=n(!1),r=n({}),u=n(null),C=n({}),b=n(!1),j=n(null),v=n(null),h=async t=>{t.page+=1;try{const e=await fetch(`${_}/api/master/adjustment?page=${t.page}&sortField=${t.sortField}&sortOrder=${t.sortOrder}&search=${v.value!=null?v.value:""}&paginate_count=${t.rows}`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`}}),s=await e.json();if(j.value=s.data.total,e.ok)D.value=s.data;else throw new Error(s.error||"Failed to fetch data from API")}catch{m.add({severity:"error",summary:"Error",detail:"Failed to fetch data from API",life:5e3})}},M=t=>{var e,s,a;t.target.value?v.value=t.target.value:v.value="",h({page:0,search:v.value,sortField:(e=u.value)==null?void 0:e.sortField,sortOrder:(s=u.value)==null?void 0:s.sortOrder,rows:(a=u.value)==null?void 0:a.rows})};X(()=>{const t=N.state.permission;t!==null?(c.value=t,A.value=c.value.some(e=>e.name==="create-master"),P.value=c.value.some(e=>e.name==="edit-master"),T.value=c.value.some(e=>e.name==="delete-master")):N.watch(e=>e.permission,e=>{c.value=e,A.value=c.value.some(s=>s.name==="create-master"),P.value=c.value.some(s=>s.name==="edit-master"),T.value=c.value.some(s=>s.name==="delete-master")}),H()}),Z(async()=>{try{const t=await fetch(`${_}/api/master/adjustment`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`}}),e=await t.json();if(t.ok)D.value=e.data,j.value=e.data.total;else throw new Error(e.error||"Failed to fetch data from API")}catch{m.add({severity:"error",summary:"Error",detail:"Failed to fetch data from API",life:5e3})}});const V=()=>{r.value={},b.value=!1,y.value=!0,F.value="Add New Adjustment Category"},z=()=>{y.value=!1,b.value=!1},L=async()=>{var t,e,s;try{const a=await fetch(`${_}/api/master/adjustment/${r.value.id}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({name:r.value.name})}),p=await a.json();if(a.ok)h({page:0,search:v.value,sortField:(t=u.value)==null?void 0:t.sortField,sortOrder:(e=u.value)==null?void 0:e.sortOrder,rows:(s=u.value)==null?void 0:s.rows}),m.add({severity:"success",summary:"Successful",detail:"Data Adjs. Category Updated",life:3e3});else throw new Error(p.error||"Failed to update data Adjs. Category")}catch(a){m.add({severity:"error",summary:"Failed",detail:a,life:5e3})}},R=async()=>{var t,e,s;try{const a=await fetch(`${_}/api/master/adjustment`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({name:r.value.name})}),p=await a.json();if(a.ok)h({page:0,search:v.value,sortField:(t=u.value)==null?void 0:t.sortField,sortOrder:(e=u.value)==null?void 0:e.sortOrder,rows:(s=u.value)==null?void 0:s.rows}),m.add({severity:"success",summary:"Successful",detail:"Data Adjs. Category Created",life:3e3});else throw new Error(p.error||"Failed to create data Adjs. Category")}catch(a){m.add({severity:"error",summary:"Failed",detail:a,life:5e3})}},U=()=>{b.value=!0,r.value.name&&r.value.name.trim()&&(r.value.id?L():R(),y.value=!1,r.value={})},q=t=>{r.value={...t},y.value=!0,F.value="Edit Adjustment Category"},G=t=>{r.value=t,w.value=!0},J=async()=>{var t,e,s;try{const a=await fetch(`${_}/api/master/adjustment/${r.value.id}`,{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`}}),p=await a.json();if(a.ok)h({page:0,search:v.value,sortField:(t=u.value)==null?void 0:t.sortField,sortOrder:(e=u.value)==null?void 0:e.sortOrder,rows:(s=u.value)==null?void 0:s.rows}),w.value=!1,r.value={},m.add({severity:"success",summary:"Successful",detail:"Adjustment Category Deleted",life:3e3});else throw a.status===500&&p.error.includes("Integrity constraint violation")?new Error("Tidak dapat hapus data ini, karena masih digunakan pada data lain"):new Error(p.error||"Failed to delete Adjustment Category")}catch(a){m.add({severity:"error",summary:"Error",detail:a.message,life:5e3})}},H=()=>{C.value={global:{value:null,matchMode:ee.CONTAINS}}};return(t,e)=>{const s=f("Toast"),a=f("Button"),p=f("Toolbar"),O=f("InputText"),S=f("Column"),K=f("DataTable"),B=f("Dialog");return g(),$("div",ae,[l("div",se,[l("div",oe,[i(s),i(p,{class:"mb-4 p-0",style:{border:"none","background-color":"white"}},{start:d(()=>[re]),end:d(()=>[A.value?(g(),E(a,{key:0,label:"Add New",icon:"pi pi-plus-circle",class:"p-button-primary mr-2",onClick:V})):k("",!0)]),_:1}),i(K,{ref_key:"dt",ref:u,value:D.value.data,lazy:"",filters:C.value,first:t.first,onPage:e[2]||(e[2]=o=>h(o)),last:j.value,loading:t.loading,totalRecords:j.value,dataKey:"id",class:"p-datatable-gridlines",paginator:!0,onSort:e[3]||(e[3]=o=>h(o)),rows:10,paginatorTemplate:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",rowsPerPageOptions:[5,10,25],currentPageReportTemplate:"Showing {first} to {last} of {totalRecords} datamaster",responsiveLayout:"scroll"},{header:d(()=>[l("div",le,[l("span",ne,[ie,i(O,{modelValue:C.value.global.value,"onUpdate:modelValue":e[0]||(e[0]=o=>C.value.global.value=o),placeholder:"Search...",onInput:e[1]||(e[1]=o=>M(o))},null,8,["modelValue"])])])]),default:d(()=>[i(S,{field:"rowIndex",headerStyle:"min-width:5%;",style:{"text-align":"center"}},{header:d(()=>[de]),body:d(o=>[x(I(o.index+1),1)]),_:1}),i(S,{field:"name",headerStyle:"width:60%; min-width:10rem;"},{header:d(()=>[ue]),body:d(o=>[x(I(o.data.name),1)]),_:1}),i(S,{headerStyle:"min-width:10rem;",style:{"text-align":"center"}},{header:d(()=>[ce]),body:d(o=>[P.value?(g(),E(a,{key:0,icon:"pi pi-file-edit",class:"p-button-text p-button-primary mt-2",onClick:Y=>q(o.data)},null,8,["onClick"])):k("",!0),T.value?(g(),E(a,{key:1,icon:"pi pi-trash",class:"p-button-text p-button-danger mt-2",onClick:Y=>G(o.data)},null,8,["onClick"])):k("",!0)]),_:1})]),_:1},8,["value","filters","first","last","loading","totalRecords"]),i(B,{visible:y.value,"onUpdate:visible":e[5]||(e[5]=o=>y.value=o),style:{width:"450px"},header:F.value,modal:!0,class:"p-fluid"},{footer:d(()=>[i(a,{label:"Cancel",icon:"pi pi-times",onClick:z,style:{background:"white",color:"blue"}}),i(a,{label:"Save",icon:"pi pi-check",class:"p-button-primary",onClick:U})]),default:d(()=>[l("div",me,[ve,i(O,{id:"name",modelValue:r.value.name,"onUpdate:modelValue":e[4]||(e[4]=o=>r.value.name=o),modelModifiers:{trim:!0},required:"true",autofocus:"",class:te({"p-invalid":b.value&&!r.value.name})},null,8,["modelValue","class"]),b.value&&!r.value.name?(g(),$("small",pe,"Adjustment Category is required.")):k("",!0)])]),_:1},8,["visible","header"]),i(B,{visible:w.value,"onUpdate:visible":e[7]||(e[7]=o=>w.value=o),style:{width:"450px"},header:"Confirm",modal:!0},{footer:d(()=>[i(a,{label:"No",icon:"pi pi-times",style:{background:"white",color:"red",borderColor:"red"},onClick:e[6]||(e[6]=o=>w.value=!1)}),i(a,{label:"Yes",icon:"pi pi-check",class:"p-button-primary",onClick:J})]),default:d(()=>[l("div",fe,[ye,r.value?(g(),$("span",he,[x("Are you sure you want to delete "),l("b",null,I(r.value.name),1),x("?")])):k("",!0)])]),_:1},8,["visible"])])])])}}};export{be as default};
