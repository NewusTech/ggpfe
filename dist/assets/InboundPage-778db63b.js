import{m as Q,r as c,u as X,w as Y,n as Z,l as ee,j as R,q as te,d as h,o as _,e as I,f as l,g as s,s as a,v as L,x as ae,y as d,t as i}from"./index-2eb3e8c7.js";class oe{getProductsSmall(){return fetch("demo/data/products-small.json").then(u=>u.json()).then(u=>u.data)}getProducts(){return fetch("demo/data/products.json").then(u=>u.json()).then(u=>u.data)}getProductsWithOrdersSmall(){return fetch("demo/data/products-orders-small.json").then(u=>u.json()).then(u=>u.data)}}const se={class:"grid mt-1"},le={class:"col-12"},re={class:"card"},ne=l("div",{class:"my-2"},[l("h5",{class:"m-0"},"Inbound")],-1),de={class:"flex flex-column md:flex-row md:justify-content-between md:align-items-center"},ie={class:"block mt-2 md:mt-0 p-input-icon-left"},ce=l("i",{class:"pi pi-search"},null,-1),ue={class:"block mt-2 md:mt-0 p-input-icon-left"},me=l("div",{class:"flex flex-column md:flex-row md:justify-content-between md:align-items-center",style:{"text-align":"center",width:"100%"}},[l("span",{style:{width:"100%"}},"No")],-1),fe=l("div",{class:"flex flex-column md:flex-row md:justify-content-between md:align-items-center",style:{"text-align":"center",width:"90%"}},[l("span",{style:{width:"100%"}},"Code")],-1),he=l("div",{class:"flex flex-column md:flex-row md:justify-content-between md:align-items-center",style:{"text-align":"center",width:"90%"}},[l("span",{style:{width:"100%"}},"Date")],-1),pe=l("div",{class:"flex flex-column md:flex-row md:justify-content-between md:align-items-center",style:{"text-align":"center",width:"90%"}},[l("span",{style:{width:"100%"}},"Reference Type")],-1),ye=l("div",{class:"flex flex-column md:flex-row md:justify-content-between md:align-items-center",style:{"text-align":"center",width:"90%"}},[l("span",{style:{width:"100%"}},"Vendor")],-1),ve=l("div",{class:"flex flex-column md:flex-row md:justify-content-between md:align-items-center",style:{"text-align":"center",width:"90%"}},[l("span",{style:{width:"100%"}},"Storage Location")],-1),_e=l("div",{class:"flex flex-column md:flex-row md:justify-content-between md:align-items-center",style:{"text-align":"center",width:"100%"}},[l("span",{style:{width:"100%"}},"Status")],-1),ge={key:0,style:{color:"green"}},we={key:1,class:"text-primary"},be=l("div",{class:"field"},[l("label",{for:"material_code"},"Choose your data to release")],-1),xe={class:"p-1"},Se={key:1,class:"text-center m-0 p-0"},ke={__name:"InboundPage",setup($){const u=Q(),S=c(null),A=c(null),M=c(null),N=new oe,F=c(""),P=X(),k=c([]),g=c(null),j=c({}),T=c(null),y=c(null),U=c([]),w=c(!1),b=c(),x=c(),E=c([]),O=c({}),V=()=>{const o=b.value.map(e=>e.materials).flat();x.value=[...o]};Y(()=>b.value,()=>{V()});const C=async o=>{o.page+=1;try{const e=`${R}/api/inbound?page=${o.page}&sortField=${o.sortField}&sortOrder=${o.sortOrder}&search=${y.value!=null?y.value:""}`,n=await fetch(e,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`}}),f=await n.json();if(T.value=f.data.total,n.ok)k.value=f.data.data;else throw new Error(f.error||"Failed to fetch data from API")}catch(e){console.error("Error fetching data from API:",e),P.add({severity:"error",summary:"Error",detail:"Failed to fetch data from API",life:5e3})}},z=o=>{var e,n;o.target.value?y.value=o.target.value:y.value="",C({page:0,search:y.value,sortField:(e=g.value)==null?void 0:e.sortField,sortOrder:(n=g.value)==null?void 0:n.sortOrder})};Z(()=>{N.getProductsWithOrdersSmall().then(e=>M.value=e);const o=u.state.permission;o!==null?(S.value=o,A.value=S.value.some(e=>e.name==="release-inbound")):u.watch(e=>e.permission,e=>{S.value=e,A.value=S.value.some(n=>n.name==="release-inbound")}),q()});const B=o=>{if(o){const e=new Date(o),n={year:"numeric",month:"2-digit",day:"2-digit"};return e.toLocaleDateString(void 0,n)}else return"-"};ee(async()=>{try{const o=`${R}/api/inbound`,e=await fetch(o,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`}}),n=await e.json();if(e.ok)k.value=n.data.data,T.value=n.data.total;else throw new Error(n.error||"Failed to fetch data from API");const f=await fetch(`${R}/api/master/storage_location`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`}}),p=await f.json();if(f.ok)U.value=p.data.data;else throw new Error(p.error||"Failed to fetch storage location data from API")}catch(o){console.error("Error fetching data from API:",o),P.add({severity:"error",summary:"Error",detail:"Failed to fetch data from API",life:5e3})}});const q=()=>{j.value={global:{value:null,matchMode:te.CONTAINS}}},G=async()=>{O.value=k.value.filter(o=>o.status===1||o.status===2).map(o=>({...o,materials:o.materials.filter(e=>e.status===2)})),w.value=!0,F.value="Release to SAP"},K=()=>{w.value=!1},W=async()=>{var o,e;try{const n=x.value.map(r=>r.id);console.log("kamop",n);const f=`${R}/api/inbound/release`,p=await fetch(f,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({selectedIds:n})}),v=await p.json();if(p.ok)w.value=!1,b.value=[],x.value=[],C({page:0,search:y.value,sortField:(o=g.value)==null?void 0:o.sortField,sortOrder:(e=g.value)==null?void 0:e.sortOrder}),P.add({severity:"success",summary:"Success",detail:v.message,life:5e3});else throw new Error(v.error||"Failed to release data")}catch(n){console.error("Error releasing data:",n),P.add({severity:"error",summary:"Error",detail:"Failed to release data",life:5e3})}};return(o,e)=>{const n=h("Toast"),f=h("Toolbar"),p=h("InputText"),v=h("Button"),r=h("Column"),H=h("router-link"),D=h("DataTable"),J=h("Dialog");return _(),I("div",se,[l("div",le,[l("div",re,[s(n),s(f,{class:"mb-4 p-0",style:{border:"none","background-color":"white"}},{start:a(()=>[ne]),_:1}),s(D,{ref_key:"dt",ref:g,value:k.value,lazy:"",filters:j.value,first:o.first,onPage:e[2]||(e[2]=t=>C(t)),last:T.value,loading:o.loading,totalRecords:T.value,dataKey:"id",class:"p-datatable-gridlines",paginator:!0,onSort:e[3]||(e[3]=t=>C(t)),rows:10,paginatorTemplate:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",rowsPerPageOptions:[5,10,25],currentPageReportTemplate:"Showing {first} to {last} of {totalRecords} datamaster",responsiveLayout:"scroll"},{header:a(()=>[l("div",de,[l("span",ie,[ce,s(p,{modelValue:j.value.global.value,"onUpdate:modelValue":e[0]||(e[0]=t=>j.value.global.value=t),placeholder:"Search...",onInput:e[1]||(e[1]=t=>z(t))},null,8,["modelValue"])]),l("span",ue,[A.value?(_(),L(v,{key:0,label:"Realese to SAP",class:"p-button-primary mr-2",onClick:G})):ae("",!0)])])]),default:a(()=>[s(r,{field:"rowIndex",headerStyle:"width:5%;",style:{"text-align":"center"}},{header:a(()=>[me]),body:a(t=>[d(i(t.index+1),1)]),_:1}),s(r,{field:"code",headerStyle:"width:10%;"},{header:a(()=>[fe]),body:a(t=>[s(H,{to:"/inbound/"+t.data.id,class:"text-primary"},{default:a(()=>[d(i(t.data.code),1)]),_:2},1032,["to"])]),_:1}),s(r,{field:"date",headerStyle:"width:10%;"},{header:a(()=>[he]),body:a(t=>[d(i(B(t.data.date)),1)]),_:1}),s(r,{field:"reference_type",headerStyle:"width:20%;"},{header:a(()=>[pe]),body:a(t=>[d(i(t.data.ref_type),1)]),_:1}),s(r,{field:"from_name",headerStyle:"width:20%;"},{header:a(()=>[ye]),body:a(t=>[d(i(t.data.from),1)]),_:1}),s(r,{field:"s_loc",headerStyle:"width:18%;"},{header:a(()=>[ve]),body:a(t=>[d(i(t.data.s_loc),1)]),_:1}),s(r,{style:{"text-align":"center"},field:"status",headerStyle:"width:17%;"},{header:a(()=>[_e]),body:a(t=>[t.data.status==2?(_(),I("p",ge,"Complete")):(_(),I("p",we,"On Progress"))]),_:1})]),_:1},8,["value","filters","first","last","loading","totalRecords"]),s(J,{visible:w.value,"onUpdate:visible":e[7]||(e[7]=t=>w.value=t),style:{width:"90%"},header:F.value,modal:!0,class:"p-fluid"},{footer:a(()=>[s(v,{label:"Cancel",onClick:K,style:{background:"white",color:"blue"}}),s(v,{label:"Release",icon:"pi pi-check",class:"p-button-primary",onClick:W})]),default:a(()=>[be,s(D,{selection:b.value,"onUpdate:selection":e[5]||(e[5]=t=>b.value=t),value:O.value,expandedRows:E.value,"onUpdate:expandedRows":e[6]||(e[6]=t=>E.value=t),dataKey:"id",responsiveLayout:"scroll"},{expansion:a(t=>[l("div",xe,[t.data.materials.length?(_(),L(D,{key:0,selection:x.value,"onUpdate:selection":e[4]||(e[4]=m=>x.value=m),value:t.data.materials,responsiveLayout:"scroll"},{default:a(()=>[s(r,{selectionMode:"multiple",headerStyle:"width: 3rem"}),s(r,{field:"code",header:"Material Code"},{body:a(m=>[d(i(m.data.code),1)]),_:2},1024),s(r,{field:"desc",header:"Material Desciption"},{body:a(m=>[d(i(m.data.desc),1)]),_:2},1024),s(r,{field:"plant",header:"Plant"},{body:a(m=>[d(i(m.data.plant),1)]),_:2},1024),s(r,{field:"qty",header:"Qty"},{body:a(m=>[d(i(m.data.qty),1)]),_:2},1024),s(r,{field:"uom",header:"UoM"},{body:a(m=>[d(i(m.data.uom),1)]),_:2},1024),s(r,{field:"date",header:"Requirement Date"},{body:a(m=>[d(i(B(m.data.date)),1)]),_:2},1024)]),_:2},1032,["selection","value"])):(_(),I("div",Se," No materials available for this item. "))])]),default:a(()=>[s(r,{selectionMode:"multiple",headerStyle:"width: 3rem"}),s(r,{field:"code",header:"Code"},{body:a(t=>[d(i(t.data.code),1)]),_:1}),s(r,{field:"date",header:"Date"},{body:a(t=>[d(i(t.data.date),1)]),_:1}),s(r,{field:"ref_type",header:"Reference Type"},{body:a(t=>[d(i(t.data.ref_type),1)]),_:1}),s(r,{field:"from",header:"from"},{body:a(t=>[d(i(t.data.from),1)]),_:1}),s(r,{field:"s_loc",header:"Storage Location"},{body:a(t=>[d(i(t.data.s_loc),1)]),default:a(()=>[d("\\ ")]),_:1}),s(r,{field:"status",header:"Status"},{body:a(t=>[d(i(t.data.status===2?"Completed":"On Progress"),1)]),_:1}),s(r,{header:"Action",expander:!0,headerStyle:"min-width: 3rem"})]),_:1},8,["selection","value","expandedRows"])]),_:1},8,["visible","header"])])])])}}};export{ke as default};
