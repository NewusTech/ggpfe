import{m as Z,r as d,u as ee,n as te,l as ae,j as k,q as oe,d as y,o as u,e as w,f as r,g as n,s as i,v as A,x as _,y as x,t as g,z as V}from"./index-2eb3e8c7.js";const se={class:"grid"},le={class:"col-12"},re={class:"card"},ie=r("div",{class:"my-2"},[r("h5",{class:"m-0"},"Master Good Recipient")],-1),ne={class:"flex flex-column md:flex-row md:justify-content-between md:align-items-center"},de={class:"block mt-2 md:mt-0 p-input-icon-left"},ce=r("i",{class:"pi pi-search"},null,-1),ue=r("div",{class:"flex flex-column md:flex-row md:justify-content-between md:align-items-center",style:{"text-align":"center",width:"100%"}},[r("span",{style:{width:"100%"}},"No")],-1),me=r("div",{class:"flex flex-column md:flex-row md:justify-content-between md:align-items-center",style:{"text-align":"center",width:"90%"}},[r("span",{style:{width:"100%"}},"Code")],-1),pe=r("div",{class:"flex flex-column md:flex-row md:justify-content-between md:align-items-center",style:{"text-align":"center",width:"90%"}},[r("span",{style:{width:"100%"}},"Description")],-1),ve=r("div",{class:"flex flex-column md:flex-row md:justify-content-between md:align-items-center",style:{"text-align":"center",width:"90%"}},[r("span",{style:{width:"100%"}},"Department")],-1),he=r("div",{class:"flex flex-column md:flex-row md:justify-content-between md:align-items-center",style:{"text-align":"center",width:"100%"}},[r("span",{style:{width:"100%"}},"Action")],-1),fe={class:"field"},ye=r("label",{for:"code"},"Good Recipient",-1),we={key:0,class:"p-invalid"},_e={class:"field"},ge=r("label",{for:"desc"},"Description",-1),be={key:0,class:"p-invalid"},ke={class:"field"},xe=r("label",{for:"department",class:"mb-3"},"Department",-1),De={key:0},Ce={key:1},Te={key:0,class:"p-invalid"},Se={class:"flex align-items-center justify-content-center"},Fe=r("i",{class:"pi pi-exclamation-triangle mr-3",style:{"font-size":"2rem"}},null,-1),$e={key:0},Ee={__name:"RecipientPage",setup(Pe){const O=Z(),p=d(null),v=ee(),F=d(null),$=d(null),P=d(null),j=d([]),E=d(""),b=d(!1),D=d(!1),t=d({}),c=d(null),T=d({}),m=d(!1),B=d(null),h=d(null),I=d([]),S=async o=>{o.page+=1;try{const e=await fetch(`${k}/api/master/good_recepient?page=${o.page}&sortField=${o.sortField}&sortOrder=${o.sortOrder}&search=${h.value!=null?h.value:""}&paginate_count=${o.rows}`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`}}),l=await e.json();if(B.value=l.data.total,e.ok)j.value=l.data;else throw new Error(l.error||"Failed to fetch data from API")}catch{v.add({severity:"error",summary:"Error",detail:"Failed to fetch data from API",life:5e3})}},N=o=>{var e,l,s;o.target.value?h.value=o.target.value:h.value="",S({page:0,search:h.value,sortField:(e=c.value)==null?void 0:e.sortField,sortOrder:(l=c.value)==null?void 0:l.sortOrder,rows:(s=c.value)==null?void 0:s.rows})};te(()=>{const o=O.state.permission;o!==null?(p.value=o,F.value=p.value.some(e=>e.name==="create-master"),$.value=p.value.some(e=>e.name==="edit-master"),P.value=p.value.some(e=>e.name==="delete-master")):O.watch(e=>e.permission,e=>{p.value=e,F.value=p.value.some(l=>l.name==="create-master"),$.value=p.value.some(l=>l.name==="edit-master"),P.value=p.value.some(l=>l.name==="delete-master")}),Y()}),ae(async()=>{try{const o=await fetch(`${k}/api/master/good_recepient`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`}}),e=await o.json();if(o.ok)j.value=e.data,B.value=e.data.total;else throw new Error(e.error||"Failed to fetch data from API");const l=await fetch(`${k}/api/master/department`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`}}),s=await l.json();if(l.ok)I.value=s.data.data;else throw new Error(s.error||"Failed to fetch department data from API")}catch{v.add({severity:"error",summary:"Error",detail:"Failed to fetch data from API",life:5e3})}});const M=()=>{t.value={},m.value=!1,b.value=!0,E.value="Add New Good Recipient"},z=()=>{b.value=!1,m.value=!1},L=async()=>{var o,e,l;try{const s=await fetch(`${k}/api/master/good_recepient/${t.value.id}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({code:t.value.code,desc:t.value.desc,department_id:t.value.department.id})}),f=await s.json();if(s.ok)await S({page:0,search:h.value,sortField:(o=c.value)==null?void 0:o.sortField,sortOrder:(e=c.value)==null?void 0:e.sortOrder,rows:(l=c.value)==null?void 0:l.rows}),v.add({severity:"success",summary:"Successful",detail:"Data Good Recipient Updated",life:3e3});else throw new Error(f.error||"Failed to update data Good Recipient")}catch(s){v.add({severity:"error",summary:"Failed",detail:s,life:5e3})}},U=async()=>{var o,e,l;try{const s=await fetch(`${k}/api/master/good_recepient`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({code:t.value.code,desc:t.value.desc,department_id:t.value.department.id})}),f=await s.json();if(s.ok)await S({page:0,search:h.value,sortField:(o=c.value)==null?void 0:o.sortField,sortOrder:(e=c.value)==null?void 0:e.sortOrder,rows:(l=c.value)==null?void 0:l.rows}),v.add({severity:"success",summary:"Successful",detail:"Data Good Recipient Created",life:3e3});else throw new Error(f.error||"Failed to create data Good Recipient")}catch(s){v.add({severity:"error",summary:"Failed",detail:s,life:5e3})}},q=()=>{m.value=!0,t.value.code&&t.value.code.trim()&&t.value.desc&&t.value.desc.trim()&&t.value.department&&t.value.department.id!==null&&(t.value.id?L():U(),b.value=!1,t.value={})},J=o=>{t.value={...o};const e=I.value.find(l=>l.id===t.value.department_id);t.value.department=e,b.value=!0,E.value="Edit Good Recipient"},H=o=>{t.value=o,D.value=!0},K=async()=>{var o,e,l;try{const s=await fetch(`${k}/api/master/good_recepient/${t.value.id}`,{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`}}),f=await s.json();if(s.ok)await S({page:0,search:h.value,sortField:(o=c.value)==null?void 0:o.sortField,sortOrder:(e=c.value)==null?void 0:e.sortOrder,rows:(l=c.value)==null?void 0:l.rows}),D.value=!1,t.value={},v.add({severity:"success",summary:"Successful",detail:"Good Recipient Deleted",life:3e3});else throw s.status===500&&f.error.includes("Integrity constraint violation")?new Error("Tidak dapat hapus data ini, karena masih digunakan pada data lain"):new Error(f.error||"Failed to delete Good Recipient")}catch(s){v.add({severity:"error",summary:"Error",detail:s.message,life:5e3})}},Y=()=>{T.value={global:{value:null,matchMode:oe.CONTAINS}}};return(o,e)=>{const l=y("Toast"),s=y("Button"),f=y("Toolbar"),R=y("InputText"),C=y("Column"),Q=y("DataTable"),W=y("Dropdown"),G=y("Dialog");return u(),w("div",se,[r("div",le,[r("div",re,[n(l),n(f,{class:"mb-4 p-0",style:{border:"none","background-color":"white"}},{start:i(()=>[ie]),end:i(()=>[F.value?(u(),A(s,{key:0,label:"Add New",icon:"pi pi-plus-circle",class:"p-button-primary mr-2",onClick:M})):_("",!0)]),_:1}),n(Q,{ref_key:"dt",ref:c,value:j.value.data,dataKey:"id",class:"p-datatable-gridlines",paginator:!0,rows:10,filters:T.value,paginatorTemplate:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",rowsPerPageOptions:[5,10,25],currentPageReportTemplate:"Showing {first} to {last} of {totalRecords} datamaster",responsiveLayout:"scroll"},{header:i(()=>[r("div",ne,[r("span",de,[ce,n(R,{modelValue:T.value.global.value,"onUpdate:modelValue":e[0]||(e[0]=a=>T.value.global.value=a),placeholder:"Search...",onInput:e[1]||(e[1]=a=>N(a))},null,8,["modelValue"])])])]),default:i(()=>[n(C,{field:"rowIndex",headerStyle:"min-width:5%;",style:{"text-align":"center"}},{header:i(()=>[ue]),body:i(a=>[x(g(a.index+1),1)]),_:1}),n(C,{field:"code",headerStyle:"width:20%; min-width:10rem;"},{header:i(()=>[me]),body:i(a=>[x(g(a.data.code),1)]),_:1}),n(C,{field:"desc",headerStyle:"width:30%; min-width:10rem;"},{header:i(()=>[pe]),body:i(a=>[x(g(a.data.desc),1)]),_:1}),n(C,{field:"department",headerStyle:"width:30%; min-width:10rem;"},{header:i(()=>[ve]),body:i(a=>[x(g(a.data.department.name),1)]),_:1}),n(C,{headerStyle:"min-width:10rem;",style:{"text-align":"center"}},{header:i(()=>[he]),body:i(a=>[$.value?(u(),A(s,{key:0,icon:"pi pi-file-edit",class:"p-button-text p-button-primary mt-2",onClick:X=>J(a.data)},null,8,["onClick"])):_("",!0),P.value?(u(),A(s,{key:1,icon:"pi pi-trash",class:"p-button-text p-button-danger mt-2",onClick:X=>H(a.data)},null,8,["onClick"])):_("",!0)]),_:1})]),_:1},8,["value","filters"]),n(G,{visible:b.value,"onUpdate:visible":e[5]||(e[5]=a=>b.value=a),style:{width:"450px"},header:E.value,modal:!0,class:"p-fluid"},{footer:i(()=>[n(s,{label:"Cancel",icon:"pi pi-times",onClick:z,style:{background:"white",color:"blue"}}),n(s,{label:"Save",icon:"pi pi-check",class:"p-button-primary",onClick:q})]),default:i(()=>[r("div",fe,[ye,n(R,{id:"code",modelValue:t.value.code,"onUpdate:modelValue":e[2]||(e[2]=a=>t.value.code=a),modelModifiers:{trim:!0},required:"true",autofocus:"",class:V({"p-invalid":m.value&&!t.value.code})},null,8,["modelValue","class"]),m.value&&!t.value.code?(u(),w("small",we,"Good Recipient is required.")):_("",!0)]),r("div",_e,[ge,n(R,{id:"desc",modelValue:t.value.desc,"onUpdate:modelValue":e[3]||(e[3]=a=>t.value.desc=a),modelModifiers:{trim:!0},required:"true",autofocus:"",class:V({"p-invalid":m.value&&!t.value.desc})},null,8,["modelValue","class"]),m.value&&!t.value.desc?(u(),w("small",be,"Desc is required.")):_("",!0)]),r("div",ke,[xe,n(W,{id:"department",modelValue:t.value.department,"onUpdate:modelValue":e[4]||(e[4]=a=>t.value.department=a),options:I.value,optionLabel:"name",placeholder:"Select a Department",class:V({"p-invalid":m.value&&!t.value.department}),required:"true"},{value:i(a=>[a.value&&a.value.id?(u(),w("div",De,g(a.value.name),1)):(u(),w("span",Ce,g(a.placeholder),1))]),_:1},8,["modelValue","options","class"]),m.value&&!t.value.department?(u(),w("small",Te,"Department is required.")):_("",!0)])]),_:1},8,["visible","header"]),n(G,{visible:D.value,"onUpdate:visible":e[7]||(e[7]=a=>D.value=a),style:{width:"450px"},header:"Confirm",modal:!0},{footer:i(()=>[n(s,{label:"No",icon:"pi pi-times",style:{background:"white",color:"red",borderColor:"red"},onClick:e[6]||(e[6]=a=>D.value=!1)}),n(s,{label:"Yes",icon:"pi pi-check",class:"p-button-primary",onClick:K})]),default:i(()=>[r("div",Se,[Fe,t.value?(u(),w("span",$e,[x("Are you sure you want to delete "),r("b",null,g(t.value.code),1),x("?")])):_("",!0)])]),_:1},8,["visible"])])])])}}};export{Ee as default};
