import{m as te,a as ae,u as oe,r as u,n as le,l as de,j as _,w as se,q as re,d as f,o as k,e as T,f as r,g as a,s as t,x as E,y as d,t as s}from"./index-2eb3e8c7.js";const ne={class:"grid"},ie={class:"col-12"},ce={class:"card"},ue=r("div",{class:"my-2"},[r("h5",{class:"m-0"},"Request Outbound")],-1),me={key:0,class:"my-2"},pe={key:1,class:"my-2"},fe={class:"flex flex-column md:flex-row md:justify-content-between md:align-items-center"},ve={class:"block mt-2 md:mt-0 p-input-icon-left"},ye=r("i",{class:"pi pi-search"},null,-1),he=r("div",{class:"flex flex-column md:flex-row md:justify-content-between md:align-items-center",style:{"text-align":"center",width:"100%"}},[r("span",{style:{width:"100%"}},"No")],-1),_e=r("div",{class:"flex flex-column md:flex-row md:justify-content-between md:align-items-center",style:{"text-align":"center",width:"90%"}},[r("span",{style:{width:"100%"}},"Date")],-1),be=r("div",{class:"flex flex-column md:flex-row md:justify-content-between md:align-items-center",style:{"text-align":"center",width:"90%"}},[r("span",{style:{width:"100%"}},"Request Number")],-1),ge=r("div",{class:"flex flex-column md:flex-row md:justify-content-between md:align-items-center",style:{"text-align":"center",width:"90%"}},[r("span",{style:{width:"100%"}},"Reference Doc")],-1),we=r("div",{class:"flex flex-column md:flex-row md:justify-content-between md:align-items-center",style:{"text-align":"center",width:"90%"}},[r("span",{style:{width:"100%"}},"Type")],-1),xe=r("div",{class:"flex flex-column md:flex-row md:justify-content-between md:align-items-center",style:{"text-align":"center",width:"90%"}},[r("span",{style:{width:"100%"}},"Storage Location")],-1),Re=r("div",{class:"flex flex-column md:flex-row md:justify-content-between md:align-items-center",style:{"text-align":"center",width:"90%"}},[r("span",{style:{width:"100%"}},"Movement Type")],-1),Se=r("div",{class:"flex flex-column md:flex-row md:justify-content-between md:align-items-center",style:{"text-align":"center",width:"100%"}},[r("span",{style:{width:"100%"}},"Status")],-1),ke={key:0,style:{color:"green"}},Te={key:1,class:"text-primary"},qe={class:"p-3"},Ce=r("div",{class:"field"},[r("label",{for:"material_code"},"Choose your data to aprove")],-1),Ae={class:"p-3"},Pe={__name:"OutboundoverPage",setup(De){const N=te(),O=ae(),q=oe(),z=u(null),G=u(null),F=u([]),C=u(""),v=u(null),A=u({}),D=u(null),y=u(null),V=u(0),K=u(null),M=u(!1),$=u(!1),I=u(!1),b=u(!1),g=u({}),w=u({}),x=u(),R=u(),j=u([]),P=u(null),L=async i=>{i.page+=1;try{const o=await fetch(`${_}/api/outbound/request?page=${i.page}&sortField=${i.sortField}&sortOrder=${i.sortOrder}&search=${y.value!=null?y.value:""}`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`}}),m=await o.json();if(D.value=m.data.total,o.ok)F.value=m.data.data;else throw new Error(m.error||"Failed to fetch data from API")}catch{q.add({severity:"error",summary:"Error",detail:"Failed to fetch data from API",life:5e3})}},Q=i=>{var o,m;i.target.value?y.value=i.target.value:y.value="",L({page:0,search:y.value,sortField:(o=v.value)==null?void 0:o.sortField,sortOrder:(m=v.value)==null?void 0:m.sortOrder})};le(async()=>{P.value=N.state.permission,M.value=P.value.some(i=>i.name==="approve-request-outbound"),$.value=P.value.some(i=>i.name==="create-request-outbound"),console.log("storeee",P.value,"isKepalaBagian",M.value,"isAdminBagian.value",$.value),Z(),z.value=O.currentRoute.value.meta?O.currentRoute.value.meta.dataToSend.value:null});const B=i=>{const o=new Date(i),m={year:"numeric",month:"2-digit",day:"2-digit"};return o.toLocaleDateString(void 0,m)};de(async()=>{try{const o=await(await fetch(`${_}/api/auth/get_user/`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`}})).json();G.value=o.data.departement_id;const m=`${_}/api/outbound/request`,c=await fetch(m,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`}}),p=await c.json();if(c.ok)F.value=p.data.data,D.value=p.data.total;else throw new Error(p.error||"Failed to fetch data from API")}catch{q.add({severity:"error",summary:"Error",detail:"Failed to fetch data from API",life:5e3})}});const W=async()=>{const i=`${_}/api/outbound/request/referencelist`,o=await fetch(i,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`}}),m=await o.json();o.ok&&(w.value=m.data.data,console.log(w.value),w.value=w.value.filter(c=>c.status!==2).map(c=>({...c,outboundmaterialrequest:c.outboundmaterialrequest.filter(p=>p.is_aprove===0&&p.status===0)}))),I.value=!0,C.value="Reference List"},H=()=>{const i=x.value.map(o=>o.outboundmaterialrequest).flat();R.value=[...i]},J=async()=>{var o,m,c,p;const i=R.value.map(h=>h.id);try{if((await fetch(`${_}/api/outbound/request/approve`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({ids:i})})).ok)b.value=!1,x.value=[],R.value=[],console.log(y.value,(o=v.value)==null?void 0:o.sortField,(m=v.value)==null?void 0:m.sortOrder),L({page:0,search:y.value,sortField:(c=v.value)==null?void 0:c.sortField,sortOrder:(p=v.value)==null?void 0:p.sortOrder}),q.add({severity:"success",summary:"Successful",detail:"Aproved",life:3e3});else throw new Error(data.error||"Failed")}catch(h){q.add({severity:"error",summary:"Failed",detail:h,life:5e3})}};se(()=>x.value,()=>{H()});const X=async()=>{const i=`${_}/api/outbound/request/listforapprove`,o=await fetch(i,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`}}),m=await o.json();o.ok&&(g.value=m.data.data,console.log(g.value),g.value=g.value.filter(c=>c.status!==2).map(c=>({...c,outboundmaterialrequest:c.outboundmaterialrequest.filter(p=>p.is_aprove===0)}))),b.value=!0,C.value="Aproval"},Y=()=>{b.value=!1},Z=()=>{A.value={global:{value:null,matchMode:re.CONTAINS}}};return(i,o)=>{const m=f("Toast"),c=f("Button"),p=f("router-link"),h=f("Toolbar"),ee=f("InputText"),l=f("Column"),S=f("DataTable"),U=f("Dialog");return k(),T("div",ne,[r("div",ie,[r("div",ce,[a(m),a(h,{class:"mb-4 p-0",style:{border:"none","background-color":"white"}},{start:t(()=>[ue]),end:t(()=>[$.value?(k(),T("div",me,[a(c,{label:"Reference List",style:{background:"white",color:"blue"},class:"mr-2",onClick:W}),a(p,{to:"outbound-request/form-outbound"},{default:t(()=>[a(c,{label:"Add",icon:"pi pi-plus-circle",class:"p-button-primary"})]),_:1})])):E("",!0),M.value?(k(),T("div",pe,[a(c,{label:"Aproval",class:"p-button-primary",onClick:X})])):E("",!0)]),_:1}),a(S,{ref_key:"dt",ref:v,value:F.value,lazy:"",filters:A.value,first:V.value,onPage:o[2]||(o[2]=e=>L(e)),last:D.value,loading:K.value,totalRecords:D.value,dataKey:"id",class:"p-datatable-gridlines",paginator:!0,onSort:o[3]||(o[3]=e=>L(e)),rows:10,paginatorTemplate:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",rowsPerPageOptions:[5,10,25],currentPageReportTemplate:"Showing {first} to {last} of {totalRecords} datamaster",responsiveLayout:"scroll"},{header:t(()=>[r("div",fe,[r("span",ve,[ye,a(ee,{modelValue:A.value.global.value,"onUpdate:modelValue":o[0]||(o[0]=e=>A.value.global.value=e),placeholder:"Search...",onInput:o[1]||(o[1]=e=>Q(e))},null,8,["modelValue"])])])]),default:t(()=>[a(l,{field:"rowIndex",headerStyle:"min-width:5%;",style:{"text-align":"center"}},{header:t(()=>[he]),body:t(e=>[d(s(e.index+1),1)]),_:1}),a(l,{field:"created_at",headerStyle:"width:10%;"},{header:t(()=>[_e]),body:t(e=>[d(s(B(e.data.created_at)),1)]),_:1}),a(l,{field:"code",headerStyle:"width:20%;"},{header:t(()=>[be]),body:t(e=>[d(s(e.data.code),1)]),_:1}),a(l,{field:"ref_code",headerStyle:"width:20%;"},{header:t(()=>[ge]),body:t(e=>[d(s(e.data.ref_code),1)]),_:1}),a(l,{field:"type",headerStyle:"width:15%;"},{header:t(()=>[we]),body:t(e=>[d(s(e.data.reference_code===null?"Without Reference":"With Reference"),1)]),_:1}),a(l,{field:"sloc",headerStyle:"width:21%;"},{header:t(()=>[xe]),body:t(e=>[d(s(e.data.sloc.name),1)]),_:1}),a(l,{field:"mvt",headerStyle:"width:20%;"},{header:t(()=>[Re]),body:t(e=>[d(s(e.data.mvt.code),1)]),_:1}),a(l,{style:{"text-align":"center"},field:"status",headerStyle:"width:17%;"},{header:t(()=>[Se]),body:t(e=>[e.data.status===2?(k(),T("p",ke,"Approved")):(k(),T("p",Te,"Request"))]),_:1})]),_:1},8,["value","filters","first","last","loading","totalRecords"]),a(U,{visible:I.value,"onUpdate:visible":o[5]||(o[5]=e=>I.value=e),style:{width:"90%"},header:C.value,modal:!0,class:"p-fluid"},{default:t(()=>[a(S,{value:w.value,expandedRows:j.value,"onUpdate:expandedRows":o[4]||(o[4]=e=>j.value=e),dataKey:"id",responsiveLayout:"scroll"},{expansion:t(e=>[r("div",qe,[a(S,{value:e.data.outboundmaterialrequest,responsiveLayout:"scroll"},{default:t(()=>[a(l,{field:"code",header:"Material Code"},{body:t(n=>[d(s(n.data.material.code),1)]),_:2},1024),a(l,{field:"desc",header:"Material Desciption"},{body:t(n=>[d(s(n.data.material.desc),1)]),_:2},1024),a(l,{field:"plant",header:"Plant"},{body:t(n=>[d(s(n.data.material.plant.name),1)]),_:2},1024),a(l,{field:"qty",header:"Qty"},{body:t(n=>[d(s(n.data.qty),1)]),_:2},1024),a(l,{field:"uom",header:"UoM"},{body:t(n=>[d(s(n.data.material.uom.name),1)]),_:2},1024),a(l,{field:"date2",header:"Requirement Date"},{body:t(n=>[d(s(B(n.data.material.created_at)),1)]),_:2},1024)]),_:2},1032,["value"])])]),default:t(()=>[a(l,{field:"ref_code",header:"Reference Doc"},{body:t(e=>[d(s(e.data.ref_code),1)]),_:1}),a(l,{field:"created_at",header:"Reference Date"},{body:t(e=>[d(s(B(e.data.created_at)),1)]),_:1}),a(l,{field:"sloc",header:"Storage Location"},{body:t(e=>[d(s(e.data.sloc.name),1)]),_:1}),a(l,{field:"mvt",header:"Movement Type"},{body:t(e=>[d(s(e.data.mvt.code),1)]),_:1}),a(l,{field:"recepient",header:"Good Recipient"},{body:t(e=>[d(s(e.data.recepient.code),1)]),_:1}),a(l,{field:"costcenter",header:"Cost Center"},{body:t(e=>[d(s(e.data.costcenter.name),1)]),_:1}),a(l,{field:"order",header:"Order"},{body:t(e=>[d(s(e.data.order),1)]),_:1}),a(l,{field:"receivingsloc",header:"Receiving S. Loc"},{body:t(e=>[d(s(e.data.receivingsloc.name),1)]),_:1}),a(l,{header:"Action",expander:!0,headerStyle:"min-width: 3rem"})]),_:1},8,["value","expandedRows"])]),_:1},8,["visible","header"]),a(U,{visible:b.value,"onUpdate:visible":o[9]||(o[9]=e=>b.value=e),style:{width:"90%"},header:C.value,modal:!0,class:"p-fluid"},{footer:t(()=>[a(c,{label:"Cancel",onClick:Y,style:{background:"white",color:"blue"}}),a(c,{label:"Aprove",onClick:J,class:"p-button-primary"})]),default:t(()=>[Ce,a(S,{selection:x.value,"onUpdate:selection":o[7]||(o[7]=e=>x.value=e),value:g.value,expandedRows:j.value,"onUpdate:expandedRows":o[8]||(o[8]=e=>j.value=e),dataKey:"id",responsiveLayout:"scroll"},{expansion:t(e=>[r("div",Ae,[a(S,{selection:R.value,"onUpdate:selection":o[6]||(o[6]=n=>R.value=n),value:e.data.outboundmaterialrequest,responsiveLayout:"scroll"},{default:t(()=>[a(l,{selectionMode:"multiple",headerStyle:"width: 3rem"}),a(l,{field:"code",header:"Material Code"},{body:t(n=>[d(s(n.data.material.code),1)]),_:2},1024),a(l,{field:"desc",header:"Material Desciption"},{body:t(n=>[d(s(n.data.material.desc),1)]),_:2},1024),a(l,{field:"plant",header:"Plant"},{body:t(n=>[d(s(n.data.material.plant.name),1)]),_:2},1024),a(l,{field:"qty",header:"Qty"},{body:t(n=>[d(s(n.data.qty),1)]),_:2},1024),a(l,{field:"qty",header:"UoM"},{body:t(n=>[d(s(n.data.qty),1)]),_:2},1024),a(l,{field:"qty",header:"Requirement Date"},{body:t(n=>[d(s(n.data.qty),1)]),_:2},1024)]),_:2},1032,["selection","value"])])]),default:t(()=>[a(l,{selectionMode:"multiple",headerStyle:"width: 3rem"}),a(l,{field:"ref_code",header:"Reference Doc"},{body:t(e=>[d(s(e.data.ref_code?e.data.ref_code:" - "),1)]),_:1}),a(l,{field:"created_at",header:"Reference Date"},{body:t(e=>[d(s(B(e.data.created_at)),1)]),_:1}),a(l,{field:"s_loc",header:"Storage Location"},{body:t(e=>[d(s(e.data.sloc.name),1)]),_:1}),a(l,{field:"mvt_code",header:"Movement Type"},{body:t(e=>[d(s(e.data.mvt.code),1)]),_:1}),a(l,{field:"recepient",header:"Good Recipient"},{body:t(e=>[d(s(e.data.recepient.code),1)]),_:1}),a(l,{field:"cost_centeer",header:"Cost Center"},{body:t(e=>[d(s(e.data.costcenter.name),1)]),_:1}),a(l,{field:"order",header:"Order"},{body:t(e=>[d(s(e.data.order),1)]),_:1}),a(l,{field:"receivingsloc",header:"Receiving S. Loc"},{body:t(e=>[d(s(e.data.receivingsloc.name),1)]),_:1}),a(l,{header:"Action",expander:!0,headerStyle:"min-width: 3rem"})]),_:1},8,["selection","value","expandedRows"])]),_:1},8,["visible","header"])])])])}}};export{Pe as default};
