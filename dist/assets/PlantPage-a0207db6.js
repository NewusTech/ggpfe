import{m as W,r as i,u as X,n as Z,l as ee,j as k,q as ae,d as f,o as g,e as E,f as r,g as d,s as n,v as j,x as P,y as w,t as I,z as te}from"./index-2eb3e8c7.js";const oe={class:"grid"},se={class:"col-12"},le={class:"card"},re=r("div",{class:"my-2"},[r("h5",{class:"m-0"},"Master Plant")],-1),ne={class:"flex flex-column md:flex-row md:justify-content-between md:align-items-center"},ie={class:"block mt-2 md:mt-0 p-input-icon-left"},de=r("i",{class:"pi pi-search"},null,-1),ue=r("div",{class:"flex flex-column md:flex-row md:justify-content-between md:align-items-center",style:{"text-align":"center",width:"100%"}},[r("span",{style:{width:"100%"}},"No")],-1),ce=r("div",{class:"flex flex-column md:flex-row md:justify-content-between md:align-items-center",style:{"text-align":"right",width:"50%"}},[r("span",{style:{width:"100%"}},"Name")],-1),me=r("div",{class:"flex flex-column md:flex-row md:justify-content-between md:align-items-center",style:{"text-align":"center",width:"100%"}},[r("span",{style:{width:"100%"}},"Action")],-1),pe={class:"field"},ve=r("label",{for:"name"},"Name",-1),fe={key:0,class:"p-invalid"},he={class:"flex align-items-center justify-content-center"},ye=r("i",{class:"pi pi-exclamation-triangle mr-3",style:{"font-size":"2rem"}},null,-1),ge={key:0},be={__name:"PlantPage",setup(we){const O=W(),c=i(null),m=X(),T=i(null),D=i(null),S=i(null),F=i([]),$=i(""),h=i(!1),_=i(!1),l=i({}),u=i(null),x=i(null),p=i(null),C=i({}),b=i(!1),L=i(!1);Z(()=>{const a=O.state.permission;a!==null?(c.value=a,T.value=c.value.some(e=>e.name==="create-master"),D.value=c.value.some(e=>e.name==="edit-master"),S.value=c.value.some(e=>e.name==="delete-master")):O.watch(e=>e.permission,e=>{c.value=e,T.value=c.value.some(o=>o.name==="create-master"),D.value=c.value.some(o=>o.name==="edit-master"),S.value=c.value.some(o=>o.name==="delete-master")}),K()});const y=async a=>{a.page+=1;try{const e=await fetch(`${k}/api/master/plant?page=${a.page}&sortField=${a.sortField}&sortOrder=${a.sortOrder}&search=${p.value!=null?p.value:""}&paginate_count=${a.rows}`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`}}),o=await e.json();if(x.value=o.data.total,e.ok)F.value=o.data;else throw new Error(o.error||"Failed to fetch data from API")}catch{m.add({severity:"error",summary:"Error",detail:"Failed to fetch data from API",life:5e3})}},M=a=>{var e,o,t;a.target.value?p.value=a.target.value:p.value="",y({page:0,search:p.value,sortField:(e=u.value)==null?void 0:e.sortField,sortOrder:(o=u.value)==null?void 0:o.sortOrder,rows:(t=u.value)==null?void 0:t.rows})};ee(async()=>{try{const a=await fetch(`${k}/api/master/plant`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`}}),e=await a.json();if(a.ok)F.value=e.data,x.value=e.data.total;else throw new Error(e.error||"Failed to fetch data from API")}catch{m.add({severity:"error",summary:"Error",detail:"Failed to fetch data from API",life:5e3})}});const V=()=>{l.value={},b.value=!1,h.value=!0,$.value="Add New Plant"},z=()=>{h.value=!1,b.value=!1},R=async()=>{var a,e,o;try{const t=await fetch(`${k}/api/master/plant/${l.value.id}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({name:l.value.name})}),v=await t.json();if(t.ok)await y({page:0,search:p.value,sortField:(a=u.value)==null?void 0:a.sortField,sortOrder:(e=u.value)==null?void 0:e.sortOrder,rows:(o=u.value)==null?void 0:o.rows}),m.add({severity:"success",summary:"Successful",detail:"Data Plant Updated",life:3e3});else throw new Error(v.error||"Failed to update data Plant")}catch(t){m.add({severity:"error",summary:"Failed",detail:t,life:5e3})}},U=async()=>{var a,e,o;try{const t=await fetch(`${k}/api/master/plant`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({name:l.value.name})}),v=await t.json();if(t.ok)y({page:0,search:p.value,sortField:(a=u.value)==null?void 0:a.sortField,sortOrder:(e=u.value)==null?void 0:e.sortOrder,rows:(o=u.value)==null?void 0:o.rows}),m.add({severity:"success",summary:"Successful",detail:"Data Plant Created",life:3e3});else throw new Error(v.error||"Failed to create data Plant")}catch(t){m.add({severity:"error",summary:"Failed",detail:t,life:5e3})}},q=()=>{b.value=!0,l.value.name&&l.value.name.trim()&&(l.value.id?R():U(),h.value=!1,l.value={})},G=a=>{l.value={...a},h.value=!0,$.value="Edit Plant"},J=a=>{l.value=a,_.value=!0},H=async()=>{var a,e,o;try{const t=await fetch(`${k}/api/master/plant/${l.value.id}`,{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`}}),v=await t.json();if(t.ok)y({page:0,search:p.value,sortField:(a=u.value)==null?void 0:a.sortField,sortOrder:(e=u.value)==null?void 0:e.sortOrder,rows:(o=u.value)==null?void 0:o.rows}),_.value=!1,l.value={},m.add({severity:"success",summary:"Successful",detail:"Data Plant Deleted",life:3e3});else throw t.status===500&&v.error.includes("Integrity constraint violation")?new Error("Tidak dapat hapus data ini, karena masih digunakan pada data lain"):new Error(v.error||"Failed to delete Storage Location")}catch(t){m.add({severity:"error",summary:"Error",detail:t.message,life:5e3})}},K=()=>{C.value={global:{value:null,matchMode:ae.CONTAINS}}};return(a,e)=>{const o=f("Toast"),t=f("Button"),v=f("Toolbar"),A=f("InputText"),N=f("Column"),Y=f("DataTable"),B=f("Dialog");return g(),E("div",oe,[r("div",se,[r("div",le,[d(o),d(v,{class:"mb-4 p-0",style:{border:"none","background-color":"white"}},{start:n(()=>[re]),end:n(()=>[T.value?(g(),j(t,{key:0,label:"Add New",icon:"pi pi-plus-circle",class:"p-button-primary mr-2",onClick:V})):P("",!0)]),_:1}),d(Y,{ref_key:"dt",ref:u,value:F.value.data,lazy:"",filters:C.value,first:a.first,onPage:e[2]||(e[2]=s=>y(s)),last:x.value,loading:L.value,totalRecords:x.value,dataKey:"id",class:"p-datatable-gridlines",paginator:!0,onSort:e[3]||(e[3]=s=>y(s)),rows:10,paginatorTemplate:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",rowsPerPageOptions:[5,10,25],currentPageReportTemplate:"Showing {first} to {last} of {totalRecords} datamaster",responsiveLayout:"scroll"},{header:n(()=>[r("div",ne,[r("span",ie,[de,d(A,{modelValue:C.value.global.value,"onUpdate:modelValue":e[0]||(e[0]=s=>C.value.global.value=s),placeholder:"Search...",onInput:e[1]||(e[1]=s=>M(s))},null,8,["modelValue"])])])]),empty:n(()=>[w(" No data found. ")]),loading:n(()=>[w(" Loading customers data. Please wait. ")]),default:n(()=>[d(N,{field:"rowIndex",headerStyle:"min-width:5%;",style:{"text-align":"center"}},{header:n(()=>[ue]),body:n(s=>[w(I(s.index+1),1)]),_:1}),d(N,{field:"name",headerStyle:"width:60%; min-width:10rem;"},{header:n(()=>[ce]),body:n(s=>[w(I(s.data.name),1)]),_:1}),d(N,{headerStyle:"min-width:10rem;",style:{"text-align":"center"}},{header:n(()=>[me]),body:n(s=>[D.value?(g(),j(t,{key:0,icon:"pi pi-file-edit",class:"p-button-text p-button-primary mt-2",onClick:Q=>G(s.data)},null,8,["onClick"])):P("",!0),S.value?(g(),j(t,{key:1,icon:"pi pi-trash",class:"p-button-text p-button-danger mt-2",onClick:Q=>J(s.data)},null,8,["onClick"])):P("",!0)]),_:1})]),_:1},8,["value","filters","first","last","loading","totalRecords"]),d(B,{visible:h.value,"onUpdate:visible":e[5]||(e[5]=s=>h.value=s),style:{width:"450px"},header:$.value,modal:!0,class:"p-fluid"},{footer:n(()=>[d(t,{label:"Cancel",icon:"pi pi-times",onClick:z,style:{background:"white",color:"blue"}}),d(t,{label:"Save",icon:"pi pi-check",class:"p-button-primary",onClick:q})]),default:n(()=>[r("div",pe,[ve,d(A,{id:"name",modelValue:l.value.name,"onUpdate:modelValue":e[4]||(e[4]=s=>l.value.name=s),modelModifiers:{trim:!0},required:"true",autofocus:"",class:te({"p-invalid":b.value&&!l.value.name})},null,8,["modelValue","class"]),b.value&&!l.value.name?(g(),E("small",fe,"Name is required.")):P("",!0)])]),_:1},8,["visible","header"]),d(B,{visible:_.value,"onUpdate:visible":e[7]||(e[7]=s=>_.value=s),style:{width:"450px"},header:"Confirm",modal:!0},{footer:n(()=>[d(t,{label:"No",icon:"pi pi-times",style:{background:"white",color:"red",borderColor:"red"},onClick:e[6]||(e[6]=s=>_.value=!1)}),d(t,{label:"Yes",icon:"pi pi-check",class:"p-button-primary",onClick:H})]),default:n(()=>[r("div",he,[ye,l.value?(g(),E("span",ge,[w("Are you sure you want to delete "),r("b",null,I(l.value.name),1),w("?")])):P("",!0)])]),_:1},8,["visible"])])])])}}};export{be as default};
