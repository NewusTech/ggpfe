import{m as Q,r as n,u as W,n as X,l as Z,j as _,q as ee,d as f,o as y,e as E,f as r,g as i,s as d,v as j,x as b,y as D,t as I,z as te}from"./index-2eb3e8c7.js";const ae={class:"grid"},se={class:"col-12"},oe={class:"card"},re=r("div",{class:"my-2"},[r("h5",{class:"m-0"},"Master Department")],-1),le={class:"flex flex-column md:flex-row md:justify-content-between md:align-items-center"},ne={class:"block mt-2 md:mt-0 p-input-icon-left"},ie=r("i",{class:"pi pi-search"},null,-1),de=r("div",{class:"flex flex-column md:flex-row md:justify-content-between md:align-items-center",style:{"text-align":"center",width:"100%"}},[r("span",{style:{width:"100%"}},"No")],-1),ue=r("div",{class:"flex flex-column md:flex-row md:justify-content-between md:align-items-center",style:{"text-align":"right",width:"50%"}},[r("span",{style:{width:"100%"}},"Department")],-1),ce=r("div",{class:"flex flex-column md:flex-row md:justify-content-between md:align-items-center",style:{"text-align":"center",width:"100%"}},[r("span",{style:{width:"100%"}},"Action")],-1),me={class:"field"},pe=r("label",{for:"name"},"Department",-1),ve={key:0,class:"p-invalid"},fe={class:"flex align-items-center justify-content-center"},he=r("i",{class:"pi pi-exclamation-triangle mr-3",style:{"font-size":"2rem"}},null,-1),ye={key:0},_e={__name:"DepartmentPage",setup(ge){const N=Q(),c=n(null),m=W(),C=n(null),T=n(null),P=n(null),F=n([]),S=n(""),h=n(!1),g=n(!1),o=n({}),u=n(null),k=n({}),w=n(!1),O=n(null),p=n(null),x=async t=>{t.page+=1;try{const e=await fetch(`${_}/api/master/department?page=${t.page}&sortField=${t.sortField}&sortOrder=${t.sortOrder}&search=${p.value!=null?p.value:""}&paginate_count=${t.rows}`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`}}),s=await e.json();if(O.value=s.data.total,e.ok)F.value=s.data;else throw new Error(s.error||"Failed to fetch data from API")}catch{m.add({severity:"error",summary:"Error",detail:"Failed to fetch data from API",life:5e3})}},M=t=>{var e,s,a;t.target.value?p.value=t.target.value:p.value="",x({page:0,search:p.value,sortField:(e=u.value)==null?void 0:e.sortField,sortOrder:(s=u.value)==null?void 0:s.sortOrder,rows:(a=u.value)==null?void 0:a.rows})};X(()=>{const t=N.state.permission;t!==null?(c.value=t,C.value=c.value.some(e=>e.name==="create-master"),T.value=c.value.some(e=>e.name==="edit-master"),P.value=c.value.some(e=>e.name==="delete-master")):N.watch(e=>e.permission,e=>{c.value=e,C.value=c.value.some(s=>s.name==="create-master"),T.value=c.value.some(s=>s.name==="edit-master"),P.value=c.value.some(s=>s.name==="delete-master")}),H()}),Z(async()=>{try{const t=await fetch(`${_}/api/master/department`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`}}),e=await t.json();if(t.ok)F.value=e.data,O.value=e.data.total;else throw new Error(e.error||"Failed to fetch data from API")}catch{m.add({severity:"error",summary:"Error",detail:"Failed to fetch data from API",life:5e3})}});const V=()=>{o.value={},w.value=!1,h.value=!0,S.value="Add New Department"},z=()=>{h.value=!1,w.value=!1},L=async()=>{var t,e,s;try{const a=await fetch(`${_}/api/master/department/${o.value.id}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({name:o.value.name})}),v=await a.json();if(a.ok)x({page:0,search:p.value,sortField:(t=u.value)==null?void 0:t.sortField,sortOrder:(e=u.value)==null?void 0:e.sortOrder,rows:(s=u.value)==null?void 0:s.rows}),m.add({severity:"success",summary:"Successful",detail:"Department Updated",life:3e3});else throw new Error(v.error||"Failed to update department")}catch(a){m.add({severity:"error",summary:"Failed",detail:a,life:5e3})}},U=async()=>{var t,e,s;try{const a=await fetch(`${_}/api/master/department`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({name:o.value.name})}),v=await a.json();if(a.ok)x({page:0,search:p.value,sortField:(t=u.value)==null?void 0:t.sortField,sortOrder:(e=u.value)==null?void 0:e.sortOrder,rows:(s=u.value)==null?void 0:s.rows}),m.add({severity:"success",summary:"Successful",detail:"Department Created",life:3e3});else throw new Error(v.error||"Failed to create department")}catch(a){m.add({severity:"error",summary:"Failed",detail:a,life:5e3})}},R=()=>{w.value=!0,o.value.name&&o.value.name.trim()&&(o.value.id?L():U(),h.value=!1,o.value={})},q=t=>{o.value={...t},h.value=!0,S.value="Edit Department"},G=t=>{o.value=t,g.value=!0},J=async()=>{var t,e,s;try{const a=await fetch(`${_}/api/master/department/${o.value.id}`,{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`}}),v=await a.json();if(a.ok)x({page:0,search:p.value,sortField:(t=u.value)==null?void 0:t.sortField,sortOrder:(e=u.value)==null?void 0:e.sortOrder,rows:(s=u.value)==null?void 0:s.rows}),g.value=!1,o.value={},m.add({severity:"success",summary:"Successful",detail:"Department Deleted",life:3e3});else throw a.status===500&&v.error.includes("Integrity constraint violation")?new Error("Tidak dapat hapus data ini, karena masih digunakan pada data lain"):new Error(v.error||"Failed to delete department")}catch(a){m.add({severity:"error",summary:"Error",detail:a.message,life:5e3})}},H=()=>{k.value={global:{value:null,matchMode:ee.CONTAINS}}};return(t,e)=>{const s=f("Toast"),a=f("Button"),v=f("Toolbar"),A=f("InputText"),$=f("Column"),K=f("DataTable"),B=f("Dialog");return y(),E("div",ae,[r("div",se,[r("div",oe,[i(s),i(v,{class:"mb-4 p-0",style:{border:"none","background-color":"white"}},{start:d(()=>[re]),end:d(()=>[C.value?(y(),j(a,{key:0,label:"Add New",icon:"pi pi-plus-circle",class:"p-button-primary mr-2",onClick:V})):b("",!0)]),_:1}),i(K,{ref_key:"dt",ref:u,value:F.value.data,dataKey:"id",paginator:!0,class:"p-datatable-gridlines",rows:10,filters:k.value,paginatorTemplate:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",rowsPerPageOptions:[5,10,25],currentPageReportTemplate:"Showing {first} to {last} of {totalRecords} datamaster",responsiveLayout:"scroll"},{header:d(()=>[r("div",le,[r("span",ne,[ie,i(A,{modelValue:k.value.global.value,"onUpdate:modelValue":e[0]||(e[0]=l=>k.value.global.value=l),placeholder:"Search...",onInput:e[1]||(e[1]=l=>M(l))},null,8,["modelValue"])])])]),default:d(()=>[i($,{field:"rowIndex",headerStyle:"min-width:5%;",style:{"text-align":"center"}},{header:d(()=>[de]),body:d(l=>[D(I(l.index+1),1)]),_:1}),i($,{field:"name",headerStyle:"width:60%; min-width:10rem;"},{header:d(()=>[ue]),body:d(l=>[D(I(l.data.name),1)]),_:1}),i($,{headerStyle:"min-width:10rem;",style:{"text-align":"center"}},{header:d(()=>[ce]),body:d(l=>[T.value?(y(),j(a,{key:0,icon:"pi pi-file-edit",class:"p-button-text p-button-primary mt-2",onClick:Y=>q(l.data)},null,8,["onClick"])):b("",!0),P.value?(y(),j(a,{key:1,icon:"pi pi-trash",class:"p-button-text p-button-danger mt-2",onClick:Y=>G(l.data)},null,8,["onClick"])):b("",!0)]),_:1})]),_:1},8,["value","filters"]),i(B,{visible:h.value,"onUpdate:visible":e[3]||(e[3]=l=>h.value=l),style:{width:"450px"},header:S.value,modal:!0,class:"p-fluid"},{footer:d(()=>[i(a,{label:"Cancel",icon:"pi pi-times",onClick:z,style:{background:"white",color:"blue"}}),i(a,{label:"Save",icon:"pi pi-check",class:"p-button-primary",onClick:R})]),default:d(()=>[r("div",me,[pe,i(A,{id:"name",modelValue:o.value.name,"onUpdate:modelValue":e[2]||(e[2]=l=>o.value.name=l),modelModifiers:{trim:!0},required:"true",autofocus:"",class:te({"p-invalid":w.value&&!o.value.name})},null,8,["modelValue","class"]),w.value&&!o.value.name?(y(),E("small",ve,"Name is required.")):b("",!0)])]),_:1},8,["visible","header"]),i(B,{visible:g.value,"onUpdate:visible":e[5]||(e[5]=l=>g.value=l),style:{width:"450px"},header:"Confirm",modal:!0},{footer:d(()=>[i(a,{label:"No",icon:"pi pi-times",style:{background:"white",color:"red",borderColor:"red"},onClick:e[4]||(e[4]=l=>g.value=!1)}),i(a,{label:"Yes",icon:"pi pi-check",class:"p-button-primary",onClick:J})]),default:d(()=>[r("div",fe,[he,o.value?(y(),E("span",ye,[D("Are you sure you want to delete "),r("b",null,I(o.value.name),1),D("?")])):b("",!0)])]),_:1},8,["visible"])])])])}}};export{_e as default};
