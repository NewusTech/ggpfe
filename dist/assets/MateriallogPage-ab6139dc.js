import{m as ie,r as d,u as ne,n as de,l as ce,j as c,q as ue,d as x,o as f,e as y,f as l,g as n,s as i,v as G,x as E,y as g,t as u,z as q}from"./index-2eb3e8c7.js";const me={class:"grid mt-1"},he={class:"col-12"},fe={class:"card"},pe=l("div",{class:"my-2"},[l("h5",{class:"m-0"},"Material Location Default")],-1),ve={class:"flex flex-column md:flex-row md:justify-content-between md:align-items-center"},_e={class:"block mt-2 md:mt-0 p-input-icon-left"},we=l("i",{class:"pi pi-search"},null,-1),ye=l("div",{class:"flex flex-column md:flex-row md:justify-content-between md:align-items-center",style:{"text-align":"center",width:"100%"}},[l("span",{style:{width:"100%"}},"No")],-1),ge=l("div",{class:"flex flex-column md:flex-row md:justify-content-between md:align-items-center",style:{"text-align":"center",width:"90%"}},[l("span",{style:{width:"100%"}},"Material Code")],-1),be=l("div",{class:"flex flex-column md:flex-row md:justify-content-between md:align-items-center",style:{"text-align":"center",width:"90%"}},[l("span",{style:{width:"100%"}},"Material Description")],-1),ke=l("div",{class:"flex flex-column md:flex-row md:justify-content-between md:align-items-center",style:{"text-align":"center",width:"90%"}},[l("span",{style:{width:"100%"}},"UoM")],-1),xe=l("div",{class:"flex flex-column md:flex-row md:justify-content-between md:align-items-center",style:{"text-align":"center",width:"90%"}},[l("span",{style:{width:"100%"}},"Plant")],-1),Se=l("div",{class:"flex flex-column md:flex-row md:justify-content-between md:align-items-center",style:{"text-align":"center",width:"90%"}},[l("span",{style:{width:"100%"}},"S. Loc")],-1),$e=l("div",{class:"flex flex-column md:flex-row md:justify-content-between md:align-items-center",style:{"text-align":"center",width:"90%"}},[l("span",{style:{width:"100%"}},"S. Loc Description")],-1),je=l("div",{class:"flex flex-column md:flex-row md:justify-content-between md:align-items-center",style:{"text-align":"center",width:"100%"}},[l("span",{style:{width:"100%"}},"S. Bin")],-1),Te=l("div",{class:"flex flex-column md:flex-row md:justify-content-between md:align-items-center",style:{"text-align":"center",width:"100%"}},[l("span",{style:{width:"100%"}},"Action")],-1),Ee={class:"flex justify-center-between",style:{width:"100%"}},Ce={class:"field",style:{width:"49%"}},Ie=l("label",{for:"code"},"Material Code",-1),Fe={key:0},Ae={key:1},De={key:0,class:"p-invalid"},Be={class:"field",style:{width:"49%","margin-left":"auto"}},Pe=l("label",{for:"material_desc"},"Material Description",-1),Ve={class:"flex justify-center-between",style:{width:"100%"}},Me={class:"field",style:{width:"49%"}},Le=l("label",{for:"uom"},"UoM",-1),ze={class:"field",style:{width:"49%","margin-left":"auto"}},Ue=l("label",{for:"plant"},"Plant",-1),Oe={class:"flex justify-center-between",style:{width:"100%"}},Ne={class:"field",style:{width:"49%"}},Ge=l("label",{for:"s_loc"},"Storage Location",-1),Re={key:0},qe={key:1},Je={class:"field",style:{width:"49%","margin-left":"auto"}},He=l("label",{for:"sloc_desc"},"Storage Location Description",-1),Ke={class:"flex justify-center-between",style:{width:"100%"}},Ye={class:"field",style:{width:"49%"}},Qe=l("label",{for:"s_bin"},"Storage Bin",-1),We={key:0},Xe={key:1},Ze={key:0,class:"p-invalid"},et={class:"flex align-items-center justify-content-center"},tt=l("i",{class:"pi pi-exclamation-triangle mr-3",style:{"font-size":"2rem"}},null,-1),at={key:0},st={__name:"MateriallogPage",setup(ot){const R=ie(),b=d(null),v=ne(),L=d(null),z=d(null),U=d(null),O=d([]),N=d(""),$=d(!1),C=d(!1),o=d({}),h=d(null),B=d({}),S=d(!1),P=d(null),k=d(null),I=d([]),V=d([]),F=d([]),j=async s=>{s.page+=1;try{const e=`${c}/api/material_location?web=1&page=${s.page}&sortField=${s.sortField}&sortOrder=${s.sortOrder}&search=${k.value!=null?k.value:""}&paginate_count=${s.rows}`,a=await fetch(e,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`}}),r=await a.json();if(P.value=r.data.total,a.ok)O.value=r.data;else throw new Error(r.error||"Failed to fetch data from API")}catch{v.add({severity:"error",summary:"Error",detail:"Failed to fetch data from API",life:5e3})}},J=s=>{var e,a,r;s.target.value?k.value=s.target.value:k.value="",j({page:0,search:k.value,sortField:(e=h.value)==null?void 0:e.sortField,sortOrder:(a=h.value)==null?void 0:a.sortOrder,rows:(r=h.value)==null?void 0:r.rows})};de(()=>{const s=R.state.permission;s!==null?(b.value=s,L.value=b.value.some(e=>e.name==="create-material-location"),z.value=b.value.some(e=>e.name==="edit-material-location"),U.value=b.value.some(e=>e.name==="delete-material-location")):R.watch(e=>e.permission,e=>{b.value=e,L.value=b.value.some(a=>a.name==="create-material-location"),z.value=b.value.some(a=>a.name==="edit-material-location"),U.value=b.value.some(a=>a.name==="delete-material-location")}),re()}),ce(async()=>{try{const s=`${c}/api/material_location?web=1`,e=await fetch(s,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`}}),a=await e.json();if(e.ok)O.value=a.data,P.value=a.data.total;else throw new Error(a.error||"Failed to fetch data from API")}catch{v.add({severity:"error",summary:"Error",detail:"Failed to fetch data from API",life:5e3})}});const H=async()=>{o.value={};const s=await fetch(`${c}/api/master/storage_bin`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`}}),e=await s.json();if(s.ok)I.value=e.data.data;else throw new Error(e.error||"Failed to fetch storage bin data from API");const a=await fetch(`${c}/api/master/storage_location`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`}}),r=await a.json();if(a.ok)V.value=r.data.data;else throw new Error(r.error||"Failed to fetch storage location data from API");const m=await fetch(`${c}/api/master/material`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`}}),_=await m.json();if(m.ok)F.value=_.data.data;else throw new Error(_.error||"Failed to fetch material code data from API");S.value=!1,$.value=!0,N.value="Add New Material Location Default"},K=()=>{$.value=!1,S.value=!1},Y=async()=>{var s,e,a;try{const r=await fetch(`${c}/api/material_location/${o.value.id}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({sbin_id:o.value.s_bin.id,material_id:o.value.code.id})}),m=await r.json();if(r.ok)await j({page:0,search:k.value,sortField:(s=h.value)==null?void 0:s.sortField,sortOrder:(e=h.value)==null?void 0:e.sortOrder,rows:(a=h.value)==null?void 0:a.rows}),v.add({severity:"success",summary:"Successful",detail:"Data Material Location Default Updated",life:3e3});else throw new Error(m.error||"Failed to update data Material Location Default")}catch(r){v.add({severity:"error",summary:"Error",detail:r,life:5e3})}},Q=async()=>{var s,e,a;try{const r=await fetch(`${c}/api/material_location`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({sbin_id:o.value.s_bin.id,material_id:o.value.code.id})}),m=await r.json();if(r.ok)await j({page:0,search:k.value,sortField:(s=h.value)==null?void 0:s.sortField,sortOrder:(e=h.value)==null?void 0:e.sortOrder,rows:(a=h.value)==null?void 0:a.rows}),v.add({severity:"success",summary:"Successful",detail:"Data Material Location Default Created",life:3e3});else throw new Error(m.error||"Failed to create data Material Location Default")}catch(r){v.add({severity:"error",summary:"Error",detail:r,life:5e3})}},W=()=>{S.value=!0,o.value.s_bin&&o.value.s_bin.id!==null&&o.value.code&&o.value.code.id!==null&&(o.value.id?Y():Q(),$.value=!1,o.value={})},X=async s=>{try{const e=await fetch(`${c}/api/master/storage_location?search=${s.value}&paginate_count=15`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`}}),a=await e.json();if(e.ok)V.value=a.data.data;else throw new Error(a.error||"Failed to fetch storage location data from API")}catch{v.add({severity:"error",summary:"Error",detail:"Failed to fetch storage locations",life:5e3})}},Z=async s=>{try{const e=await fetch(`${c}/api/master/material?search=${s.value}&paginate_count=15`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`}}),a=await e.json();if(e.ok)F.value=a.data.data;else throw new Error(a.error||"Failed to fetch storage location data from API")}catch{v.add({severity:"error",summary:"Error",detail:"Failed to fetch storage locations",life:5e3})}},ee=async s=>{try{const e=await fetch(`${c}/api/master/storage_bin?search=${s.value}&paginate_count=15`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`}}),a=await e.json();if(e.ok)I.value=a.data.data;else throw new Error(a.error||"Failed to fetch storage bin data from API")}catch{v.add({severity:"error",summary:"Error",detail:"Failed to fetch storage bins",life:5e3})}},te=async s=>{var A;o.value={...s};const e=await fetch(`${c}/api/master/storage_bin`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`}}),a=await e.json();if(e.ok)I.value=a.data.data;else throw new Error(a.error||"Failed to fetch storage bin data from API");const r=await fetch(`${c}/api/master/storage_bin?search=${(A=o.value.sbin)==null?void 0:A.name}`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`}}),m=await r.json();if(r.ok)o.value.s_bin=m.data.data[0];else throw new Error(m.error||"Failed to fetch storage bin data from API");const _=await fetch(`${c}/api/master/material`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`}}),p=await _.json();if(_.ok)F.value=p.data.data;else throw new Error(p.error||"Failed to fetch material code data from API");const M=await fetch(`${c}/api/master/material?search=${o.value.material.code}`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`}}),T=await M.json();if(M.ok)o.value.code=T.data.data[0];else throw new Error(T.error||"Failed to fetch material code data from API");$.value=!0,N.value="Edit Material Location Default"},ae=s=>{o.value=s,C.value=!0},oe=s=>{const e=F.value.find(a=>a.code===s);e&&(o.value.material_desc=e.desc,o.value.plant=e.plant.name,o.value.uom=e.uom.name,o.value.material_code_fix=s)},le=async s=>{const e=V.value.find(a=>a.name===s);if(e){o.value.sloc_desc=e.name;try{const a=await fetch(`${c}/api/master/storage_bin?s_loc=${e.id}`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`}}),r=await a.json();if(a.ok)I.value=r.data.data;else throw new Error(r.error||"Failed to fetch storage bin data from API")}catch(a){console.error("Error fetching storage bin data:",a)}}},se=async()=>{var s,e,a;try{const r=await fetch(`${c}/api/material_location/${o.value.id}`,{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`}}),m=await r.json();if(r.ok)await j({page:0,search:k.value,sortField:(s=h.value)==null?void 0:s.sortField,sortOrder:(e=h.value)==null?void 0:e.sortOrder,rows:(a=h.value)==null?void 0:a.rows}),C.value=!1,o.value={},v.add({severity:"success",summary:"Successful",detail:"material location default Deleted",life:3e3});else throw r.status===500&&m.error.includes("Integrity constraint violation")?new Error("Tidak dapat hapus data ini, karena masih digunakan pada data lain"):new Error(m.error||"Failed to delete material location default")}catch(r){v.add({severity:"error",summary:"Error",detail:r.message,life:5e3})}},re=()=>{B.value={global:{value:null,matchMode:ue.CONTAINS}}};return(s,e)=>{const a=x("Toast"),r=x("Button"),m=x("Toolbar"),_=x("InputText"),p=x("Column"),M=x("DataTable"),T=x("Dropdown"),A=x("Dialog");return f(),y("div",me,[l("div",he,[l("div",fe,[n(a),n(m,{class:"mb-4 p-0",style:{border:"none","background-color":"white"}},{start:i(()=>[pe]),end:i(()=>[L.value?(f(),G(r,{key:0,label:"Add New",icon:"pi pi-plus-circle",class:"p-button-primary mr-2",onClick:H})):E("",!0)]),_:1}),n(M,{ref_key:"dt",ref:h,value:O.value.data,lazy:"",filters:B.value,first:s.first,onPage:e[2]||(e[2]=t=>j(t)),last:P.value,loading:s.loading,totalRecords:P.value,dataKey:"id",class:"p-datatable-gridlines",paginator:!0,onSort:e[3]||(e[3]=t=>j(t)),rows:20,paginatorTemplate:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",rowsPerPageOptions:[10,20,50],currentPageReportTemplate:"Showing {first} to {last} of {totalRecords} datamaster",responsiveLayout:"scroll"},{header:i(()=>[l("div",ve,[l("span",_e,[we,n(_,{modelValue:B.value.global.value,"onUpdate:modelValue":e[0]||(e[0]=t=>B.value.global.value=t),placeholder:"Search...",onInput:e[1]||(e[1]=t=>J(t))},null,8,["modelValue"])])])]),default:i(()=>[n(p,{field:"rowIndex",headerStyle:"width:5%;",style:{"text-align":"center"}},{header:i(()=>[ye]),body:i(t=>[g(u(t.index+1),1)]),_:1}),n(p,{field:"material_code",headerStyle:"width:12%;"},{header:i(()=>[ge]),body:i(t=>[g(u(t.data.material.code),1)]),_:1}),n(p,{field:"material_desc",headerStyle:"width:15%;"},{header:i(()=>[be]),body:i(t=>[g(u(t.data.material.desc),1)]),_:1}),n(p,{field:"uom_name",headerStyle:"width:7%;"},{header:i(()=>[ke]),body:i(t=>[g(u(t.data.material.uom.name),1)]),_:1}),n(p,{field:"plant",headerStyle:"width:7%;"},{header:i(()=>[xe]),body:i(t=>[g(u(t.data.material.plant.name),1)]),_:1}),n(p,{field:"sloc_name",headerStyle:"width:7%;"},{header:i(()=>[Se]),body:i(t=>{var w,D;return[g(u((D=(w=t.data.sbin)==null?void 0:w.sloc)==null?void 0:D.name),1)]}),_:1}),n(p,{field:"sloc_description",headerStyle:"width:10%;"},{header:i(()=>[$e]),body:i(t=>{var w,D;return[g(u((D=(w=t.data.sbin)==null?void 0:w.sloc)==null?void 0:D.desc),1)]}),_:1}),n(p,{field:"s_bin",headerStyle:"width:8%;"},{header:i(()=>[je]),body:i(t=>{var w;return[g(u((w=t.data.sbin)==null?void 0:w.name),1)]}),_:1}),n(p,{style:{"text-align":"center"},headerStyle:"width:13%;"},{header:i(()=>[Te]),body:i(t=>[z.value?(f(),G(r,{key:0,icon:"pi pi-file-edit",class:"p-button-text p-button-primary mt-2",onClick:w=>te(t.data)},null,8,["onClick"])):E("",!0),U.value?(f(),G(r,{key:1,icon:"pi pi-trash",class:"p-button-text p-button-danger mt-2",onClick:w=>ae(t.data)},null,8,["onClick"])):E("",!0)]),_:1})]),_:1},8,["value","filters","first","last","loading","totalRecords"]),n(A,{visible:$.value,"onUpdate:visible":e[13]||(e[13]=t=>$.value=t),style:{width:"750px"},header:N.value,modal:!0,class:"p-fluid"},{footer:i(()=>[n(r,{label:"Cancel",icon:"pi pi-times",onClick:K,style:{background:"white",color:"blue"}}),n(r,{label:"Save",icon:"pi pi-check",class:"p-button-primary",onClick:W})]),default:i(()=>[l("div",Ee,[l("div",Ce,[Ie,n(T,{id:"code",onChange:e[4]||(e[4]=t=>oe(o.value.code.code)),modelValue:o.value.code,"onUpdate:modelValue":e[5]||(e[5]=t=>o.value.code=t),options:F.value,optionLabel:"code",placeholder:"Select material code",class:q({"p-invalid":S.value&&!o.value.code}),required:"true",onFilter:Z,filter:""},{value:i(t=>[t.value&&t.value.id?(f(),y("div",Fe,u(t.value.code),1)):(f(),y("span",Ae,u(t.placeholder),1))]),_:1},8,["modelValue","options","class"]),S.value&&!o.value.code?(f(),y("small",De,"Material code is required.")):E("",!0)]),l("div",Be,[Pe,n(_,{id:"material_desc",modelValue:o.value.material_desc,"onUpdate:modelValue":e[6]||(e[6]=t=>o.value.material_desc=t),modelModifiers:{trim:!0},disabled:""},null,8,["modelValue"])])]),l("div",Ve,[l("div",Me,[Le,n(_,{id:"uom",modelValue:o.value.uom,"onUpdate:modelValue":e[7]||(e[7]=t=>o.value.uom=t),modelModifiers:{trim:!0},disabled:""},null,8,["modelValue"])]),l("div",ze,[Ue,n(_,{id:"plant",modelValue:o.value.plant,"onUpdate:modelValue":e[8]||(e[8]=t=>o.value.plant=t),disabled:""},null,8,["modelValue"])])]),l("div",Oe,[l("div",Ne,[Ge,n(T,{id:"s_loc",modelValue:o.value.s_loc,"onUpdate:modelValue":e[9]||(e[9]=t=>o.value.s_loc=t),options:V.value,optionLabel:"name",placeholder:"Select storage location",onFilter:X,filter:"",onChange:e[10]||(e[10]=t=>le(o.value.s_loc.name))},{value:i(t=>[t.value&&t.value.id?(f(),y("div",Re,u(t.value.name),1)):(f(),y("span",qe,u(t.placeholder),1))]),_:1},8,["modelValue","options"])]),l("div",Je,[He,n(_,{id:"sloc_desc",modelValue:o.value.sloc_desc,"onUpdate:modelValue":e[11]||(e[11]=t=>o.value.sloc_desc=t),modelModifiers:{trim:!0},disabled:""},null,8,["modelValue"])])]),l("div",Ke,[l("div",Ye,[Qe,n(T,{id:"s_bin",modelValue:o.value.s_bin,"onUpdate:modelValue":e[12]||(e[12]=t=>o.value.s_bin=t),options:I.value,optionLabel:"name",placeholder:"Select storage bin",class:q({"p-invalid":S.value&&!o.value.s_bin}),required:"true",onFilter:ee,filter:""},{value:i(t=>[t.value&&t.value.id?(f(),y("div",We,u(t.value.name),1)):(f(),y("span",Xe,u(t.placeholder),1))]),_:1},8,["modelValue","options","class"]),S.value&&!o.value.s_bin?(f(),y("small",Ze,"Storage Bin is required.")):E("",!0)])])]),_:1},8,["visible","header"]),n(A,{visible:C.value,"onUpdate:visible":e[15]||(e[15]=t=>C.value=t),style:{width:"450px"},header:"Confirm",modal:!0},{footer:i(()=>[n(r,{label:"No",icon:"pi pi-times",style:{background:"white",color:"red",borderColor:"red"},onClick:e[14]||(e[14]=t=>C.value=!1)}),n(r,{label:"Yes",icon:"pi pi-check",class:"p-button-primary",onClick:se})]),default:i(()=>[l("div",et,[tt,o.value?(f(),y("span",at,[g("Are you sure you want to delete "),l("b",null,u(o.value.s_bin),1),g("?")])):E("",!0)])]),_:1},8,["visible"])])])])}}};export{st as default};
