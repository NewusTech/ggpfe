import{m as me,r as i,u as pe,n as ve,l as he,j as c,q as fe,d as v,o as d,e as u,f as s,g as r,s as n,v as _e,x as g,y as j,t as h,I as ye,z as D,F as ge,D as we}from"./index-2eb3e8c7.js";const be={class:"grid"},ke={class:"col-12"},xe={class:"card"},Ee=s("div",{class:"my-2"},[s("h5",{class:"m-0"},"Management User")],-1),Se={class:"flex flex-column md:flex-row md:justify-content-between md:align-items-center"},je={class:"block mt-2 md:mt-0 p-input-icon-left"},Te=s("i",{class:"pi pi-search"},null,-1),$e=s("div",{class:"flex flex-column md:flex-row md:justify-content-between md:align-items-center",style:{"text-align":"center",width:"100%"}},[s("span",{style:{width:"100%"}},"No")],-1),Ce=s("div",{class:"flex flex-column md:flex-row md:justify-content-between md:align-items-center",style:{"text-align":"center",width:"90%"}},[s("span",{style:{width:"100%"}},"Nama")],-1),Ie={class:"flex col m-0 p-0"},De=s("div",{class:"col-6 my-2 p-0"},"Name",-1),Ae={class:"col-6 my-2 p-0"},Pe={class:"flex col m-0 p-0"},Ue=s("div",{class:"col-6 my-2 p-0"},"Email",-1),Fe={class:"col-6 my-2 p-0"},Ve=s("div",{class:"flex flex-column md:flex-row md:justify-content-between md:align-items-center",style:{"text-align":"center",width:"90%"}},[s("span",{style:{width:"100%"}},"Storage Location")],-1),Be=s("div",{class:"flex flex-column md:flex-row md:justify-content-between md:align-items-center",style:{"text-align":"center",width:"90%"}},[s("span",{style:{width:"100%"}},"Department")],-1),Ne=s("div",{class:"flex flex-column md:flex-row md:justify-content-between md:align-items-center",style:{"text-align":"center",width:"90%"}},[s("span",{style:{width:"100%"}},"Role")],-1),ze={style:{padding:"10px","background-color":"#e9eef5",border:"0px",width:"fit-content","border-radius":"8px"}},Le=s("div",{class:"flex flex-column md:flex-row md:justify-content-between md:align-items-center",style:{"text-align":"center",width:"100%"}},[s("span",{style:{width:"100%"}},"Action")],-1),Re=["onClick"],Me=["onClick"],Oe={class:"field"},Ge=s("label",{for:"name"},"Name",-1),qe={key:0,class:"p-invalid"},Je={class:"flex justify-center-between",style:{width:"100%"}},He={class:"field",style:{width:"49%"}},Ke=s("label",{for:"email",class:"mb-3"},"Email",-1),Ye={key:0,class:"p-invalid"},Qe={class:"field",style:{width:"49%","margin-left":"auto"}},We=s("label",{for:"no_index",class:"mb-3"},"No. Index",-1),Xe={class:"flex justify-center-between",style:{width:"100%"}},Ze={class:"field",style:{width:"49%"}},ea=s("label",{for:"s_loc",class:"mb-3"},"Storage Location",-1),aa={key:0,class:"p-invalid"},ta={class:"field",style:{width:"49%","margin-left":"auto"}},oa=s("label",{for:"department",class:"mb-3"},"Department",-1),sa={key:0},la={key:1},ra={key:0,class:"p-invalid"},na={class:"field"},ia=s("label",{for:"roles",class:"mb-3"},"Role",-1),da={class:"flex flex-wrap gap-3"},ca=["for"],ua={key:0,class:"p-invalid"},ma={class:"flex align-items-center justify-content-center"},pa=s("i",{class:"pi pi-exclamation-triangle mr-3",style:{"font-size":"2rem"}},null,-1),va={key:0},_a={__name:"UserPage",setup(ha){const O=me(),w=i(null),f=pe(),A=i(null),P=i(null),U=i(null),T=i([]),F=i(""),x=i(!1),E=i(!1),a=i({}),V=i(null),$=i({}),m=i(!1),C=i(null),I=i(null),G=i([]),q=i([]),S=i([]),B=i(null),N=i({}),J=t=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t),Y=t=>{N.value=t.target.__vueParentComponent.attrs.data,B.value.toggle(t)},Q=()=>{B.value.hide()},W=t=>t.map(e=>e.role_name).join(", "),X=t=>t.map(e=>e.s_loc).join(", "),z=async t=>{t.page+=1;try{const e=await fetch(`${c}/api/users?page=${t.page}&sortField=${t.sortField}&sortOrder=${t.sortOrder}&search=${I.value}`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`}}),l=await e.json();if(C.value=l.data.total,e.ok)T.value=l.data;else throw new Error(l.error||"Failed to fetch data from API")}catch(e){console.error("Error fetching data from API:",e),f.add({severity:"error",summary:"Error",detail:"Failed to fetch data from API",life:5e3})}},Z=t=>{var e,l;t.target.value?I.value=t.target.value:I.value="",z({page:0,search:I.value,sortField:(e=V.value)==null?void 0:e.sortField,sortOrder:(l=V.value)==null?void 0:l.sortOrder})};ve(()=>{const t=O.state.permission;t!==null?(w.value=t,A.value=w.value.some(e=>e.name==="create-user"),P.value=w.value.some(e=>e.name==="edit-user"),U.value=w.value.some(e=>e.name==="delete-user")):O.watch(e=>e.permission,e=>{w.value=e,A.value=w.value.some(l=>l.name==="create-user"),P.value=w.value.some(l=>l.name==="edit-user"),U.value=w.value.some(l=>l.name==="delete-user")}),de()}),he(async()=>{try{const t=await fetch(`${c}/api/users`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`}}),e=await t.json();if(t.ok)T.value=e.data,C.value=e.data.total;else throw new Error(e.error||"Failed to fetch data from API");const l=await fetch(`${c}/api/roles`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`}}),p=await l.json();if(l.ok)q.value=p.data.data;else throw new Error(p.error||"Failed to fetch roles data from API");const b=await fetch(`${c}/api/master/department`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`}}),_=await b.json();if(b.ok)G.value=_.data.data;else throw new Error(_.error||"Failed to fetch department data from API")}catch(t){console.error("Error fetching data from API:",t),f.add({severity:"error",summary:"Error",detail:"Failed to fetch data from API",life:5e3})}});const L=async()=>{try{const t=await fetch(`${c}/api/users`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`}}),e=await t.json();if(t.ok)T.value=e.data;else throw new Error(e.error||"Failed to fetch data from API")}catch(t){console.error("Error updating data:",t),f.add({severity:"error",summary:"Error",detail:"Failed to update data",life:5e3})}},ee=async()=>{a.value={},m.value=!1;const t=await fetch(`${c}/api/master/storage_location?paginate_count=200`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`}}),e=await t.json();if(t.ok)S.value=e.data.data;else throw new Error(e.error||"Failed to fetch storage location data from API");x.value=!0,F.value="Add New User"},ae=()=>{x.value=!1,m.value=!1},te=async()=>{let t="Failed to updated data user";try{const l=await(await fetch(`${c}/api/users/${a.value.user_id}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({name:a.value.name,email:a.value.email,no_index:a.value.no_index,department_id:a.value.department.id,user_storage:a.value.s_loc,roles:a.value.roles.join(",")})})).json();if(l.success===!0)await L(),f.add({severity:"success",summary:"Successful",detail:"Data User Updated",life:3e3});else throw l.message.email[0]&&(t=l.message.email[0]),new Error(l.error||"Failed to update data User")}catch(e){console.error("Error updating data User:",e),f.add({severity:"error",summary:"Error",detail:t,life:5e3})}},oe=async()=>{let t="Failed to created data user";try{const l=await(await fetch(`${c}/api/users`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({name:a.value.name,email:a.value.email,no_index:a.value.no_index,department_id:a.value.department.id,user_storage:a.value.s_loc,roles:a.value.roles.join(",")})})).json();if(console.log(l),l.success===!0)await L(),f.add({severity:"success",summary:"Successful",detail:"Data User Created",life:3e3});else throw l.message.email[0]&&(t=l.message.email[0]),new Error(l.error||"Failed to create data User")}catch(e){console.error("Error creating data User:",e),f.add({severity:"error",summary:"Error",detail:t,life:5e3})}},se=()=>{m.value=!0,a.value.name&&a.value.name.trim()&&a.value.s_loc&&a.value.s_loc.id!==null&&a.value.email&&a.value.email.trim()&&a.value.department&&a.value.department!==null&&a.value.roles.length>0&&(a.value.user_id?te():oe(),x.value=!1,a.value={})},le=async t=>{a.value={...t};const e=S.value.find(k=>k.id===a.value.sloc_id);a.value.s_loc=e;const l=await fetch(`${c}/api/master/storage_location?paginate_count=200`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`}}),p=await l.json();if(l.ok)S.value=p.data.data;else throw new Error(p.error||"Failed to fetch storage location data from API");const b=[];for(const k of a.value.master_storage_location){const R=await(await fetch(`${c}/api/master/storage_location?&paginate_count=200&search=${k.s_loc}`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`}})).json();b.push(...R.data.data)}a.value.s_loc=b;const _=await fetch(`${c}/api/master/department?search=${a.value.name_department?a.value.name_department:""}`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`}}),y=await _.json();_.ok&&y.data.data.length>0&&(a.value.department=y.data.data[0]),a.value.roles=a.value.roles.map(k=>k.role_name),x.value=!0,F.value="Edit User"},re=t=>{a.value=t,E.value=!0},ne=async()=>{try{const t=await fetch(`${c}/api/users/${a.value.user_id}`,{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`}}),e=await t.json();if(t.ok)await L(),E.value=!1,a.value={},f.add({severity:"success",summary:"Successful",detail:"User Deleted",life:3e3});else throw t.status===500&&e.error.includes("Integrity constraint violation")?new Error("Tidak dapat hapus data ini, karena masih digunakan pada data lain"):new Error(e.error||"Failed to delete User")}catch(t){console.error("Error deleting User:",t),f.add({severity:"error",summary:"Error",detail:t.message,life:5e3})}},ie=async t=>{try{const e=await fetch(`${c}/api/master/storage_location?search=${t.value}&paginate_count=200`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`}}),l=await e.json();if(e.ok)S.value=l.data.data;else throw new Error(l.error||"Failed to fetch storage location data from API")}catch{f.add({severity:"error",summary:"Error",detail:"Failed to fetch storage locations",life:5e3})}},de=()=>{$.value={global:{value:null,matchMode:fe.CONTAINS}}};return(t,e)=>{const l=v("Toast"),p=v("Button"),b=v("Toolbar"),_=v("InputText"),y=v("Column"),k=v("OverlayPanel"),H=v("DataTable"),R=v("MultiSelect"),ce=v("Dropdown"),ue=v("Checkbox"),K=v("Dialog");return d(),u("div",be,[s("div",ke,[s("div",xe,[r(l),r(b,{class:"mb-4 p-0",style:{border:"none","background-color":"white"}},{start:n(()=>[Ee]),end:n(()=>[A.value?(d(),_e(p,{key:0,label:"Add New",icon:"pi pi-plus-circle",class:"p-button-primary mr-2",onClick:ee})):g("",!0)]),_:1}),r(H,{ref_key:"dt",ref:V,value:T.value,lazy:"",filters:$.value,first:t.first,onPage:e[2]||(e[2]=o=>z(o)),last:C.value,loading:t.loading,totalRecords:C.value,dataKey:"id",class:"p-datatable-gridlines",paginator:!0,onSort:e[3]||(e[3]=o=>z(o)),rows:10,paginatorTemplate:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",rowsPerPageOptions:[5,10,25],currentPageReportTemplate:"Showing {first} to {last} of {totalRecords} datamaster",responsiveLayout:"scroll"},{header:n(()=>[s("div",Se,[s("span",je,[Te,r(_,{modelValue:$.value.global.value,"onUpdate:modelValue":e[0]||(e[0]=o=>$.value.global.value=o),placeholder:"Search...",onInput:e[1]||(e[1]=o=>Z(o))},null,8,["modelValue"])])])]),default:n(()=>[r(y,{field:"rowIndex",headerStyle:"min-width:5%;",style:{"text-align":"center"}},{header:n(()=>[$e]),body:n(o=>[j(h(o.index+1),1)]),_:1}),r(y,{field:"name",headerStyle:"width:20%;"},{header:n(()=>[Ce]),body:n(o=>[s("p",{class:"text-primary",onMouseover:ye(Y,["prevent"]),onMouseout:Q},h(o.data.name),33),r(k,{ref_key:"op",ref:B,appendTo:"body",style:{width:"480px"}},{default:n(()=>[s("div",Ie,[De,s("div",Ae,": "+h(N.value.name),1)]),s("div",Pe,[Ue,s("div",Fe,": "+h(N.value.email),1)])]),_:1},512)]),_:1}),r(y,{field:"name_sloc",headerStyle:"width:20%;"},{header:n(()=>[Ve]),body:n(o=>[j(h(X(o.data.master_storage_location)),1)]),_:1}),r(y,{field:"name_department",headerStyle:"width:20%;"},{header:n(()=>[Be]),body:n(o=>[j(h(o.data.name_department),1)]),_:1}),r(y,{field:"name_sloc",headerStyle:"width:20%;"},{header:n(()=>[Ne]),body:n(o=>[s("div",ze,h(W(o.data.roles)),1)]),_:1}),r(y,{style:{"text-align":"center"},headerStyle:"width:15%;"},{header:n(()=>[Le]),body:n(o=>[P.value&&o.data.name!=="Admin"?(d(),u("span",{key:0,onClick:M=>le(o.data),style:{cursor:"pointer",color:"#5e42ce"},class:"mr-3"},"Edit",8,Re)):g("",!0),U.value&&o.data.name!=="Admin"?(d(),u("span",{key:1,onClick:M=>re(o.data),style:{cursor:"pointer",color:"#ff5742"}},"Delete",8,Me)):g("",!0)]),_:1})]),_:1},8,["value","filters","first","last","loading","totalRecords"]),r(K,{visible:x.value,"onUpdate:visible":e[9]||(e[9]=o=>x.value=o),style:{width:"750px"},header:F.value,modal:!0,class:"p-fluid"},{footer:n(()=>[r(p,{label:"Cancel",icon:"pi pi-times",onClick:ae,style:{background:"white",color:"blue"}}),r(p,{label:"Save",icon:"pi pi-check",class:"p-button-primary",onClick:se})]),default:n(()=>[s("div",Oe,[Ge,r(_,{id:"name",modelValue:a.value.name,"onUpdate:modelValue":e[4]||(e[4]=o=>a.value.name=o),modelModifiers:{trim:!0},required:"true",autofocus:"",class:D({"p-invalid":m.value&&!a.value.name})},null,8,["modelValue","class"]),m.value&&!a.value.name?(d(),u("small",qe,"Name is required.")):g("",!0)]),s("div",Je,[s("div",He,[Ke,r(_,{modelValue:a.value.email,"onUpdate:modelValue":e[5]||(e[5]=o=>a.value.email=o),modelModifiers:{trim:!0},required:"true",autofocus:"",class:D({"p-invalid":m.value&&!J(a.value.email)}),type:"email"},null,8,["modelValue","class"]),m.value&&!J(a.value.email)?(d(),u("small",Ye,"Invalid email address.")):g("",!0)]),s("div",Qe,[We,r(_,{modelValue:a.value.no_index,"onUpdate:modelValue":e[6]||(e[6]=o=>a.value.no_index=o),modelModifiers:{trim:!0},autofocus:""},null,8,["modelValue"])])]),s("div",Xe,[s("div",Ze,[ea,r(R,{modelValue:a.value.s_loc,"onUpdate:modelValue":e[7]||(e[7]=o=>a.value.s_loc=o),options:S.value,optionLabel:"name",onFilter:ie,filter:"",placeholder:"Select storage location",maxSelectedLabels:3,class:D({"p-invalid":m.value&&!a.value.s_loc})},null,8,["modelValue","options","class"]),m.value&&!a.value.s_loc?(d(),u("small",aa,"Storage Location is required.")):g("",!0)]),s("div",ta,[oa,r(ce,{id:"department",modelValue:a.value.department,"onUpdate:modelValue":e[8]||(e[8]=o=>a.value.department=o),options:G.value,optionLabel:"name",placeholder:"Select",class:D({"p-invalid":m.value&&!a.value.department}),required:"true"},{value:n(o=>[o.value&&o.value.id?(d(),u("div",sa,h(o.value.name),1)):(d(),u("span",la,h(o.placeholder),1))]),_:1},8,["modelValue","options","class"]),m.value&&!a.value.department?(d(),u("small",ra,"Department is required.")):g("",!0)])]),s("div",na,[ia,s("div",da,[(d(!0),u(ge,null,we(q.value,o=>(d(),u("div",{key:o.id,class:"flex align-items-center"},[r(ue,{modelValue:a.value.roles,"onUpdate:modelValue":M=>a.value.roles=M,inputId:o.id,name:o.name,value:o.name},null,8,["modelValue","onUpdate:modelValue","inputId","name","value"]),s("label",{for:o.id,class:"ml-2"},h(o.name),9,ca)]))),128))]),m.value&&!a.value.roles?(d(),u("small",ua,"Role is required.")):g("",!0)])]),_:1},8,["visible","header"]),r(K,{visible:E.value,"onUpdate:visible":e[11]||(e[11]=o=>E.value=o),style:{width:"450px"},header:"Confirm",modal:!0},{footer:n(()=>[r(p,{label:"No",icon:"pi pi-times",style:{background:"white",color:"red",borderColor:"red"},onClick:e[10]||(e[10]=o=>E.value=!1)}),r(p,{label:"Yes",icon:"pi pi-check",class:"p-button-primary",onClick:ne})]),default:n(()=>[s("div",ma,[pa,a.value?(d(),u("span",va,[j("Are you sure you want to delete "),s("b",null,h(a.value.s_bin),1),j("?")])):g("",!0)])]),_:1},8,["visible"])])])])}}};export{_a as default};
